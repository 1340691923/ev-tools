var R=Object.defineProperty;var H=(e,t,a)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var i=(e,t,a)=>(H(e,typeof t!="symbol"?t+"":t,a),a);import{s as y,E as _,H as v,g as I,r as d,z as O,o as c,c as g,h as P,a as s,w as l,A as T,k as E,F as G,q as U,i as f,t as m}from"./index-1032a0df.js";import{t as j,V as z,C as M}from"./index-29dac1de.js";import{C as q,S as J,a as $}from"./es-backup-ee2662f1.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";var Q=Object.defineProperty,W=Object.getOwnPropertyDescriptor,X=(e,t,a,r)=>{for(var n=r>1?void 0:r?W(t,a):t,u=e.length-1,b;u>=0;u--)(b=e[u])&&(n=(r?b(t,a,n):b(n))||n);return r&&n&&Q(t,a,n),n};let C=class extends z{constructor(){super(...arguments);i(this,"ctx",null);i(this,"snapshotData",null);i(this,"openAddDialog",!1);i(this,"loading",!1);i(this,"snapshotNameList",[]);i(this,"resData",{});i(this,"name","");i(this,"drawerShow",!1);i(this,"tableData",[]);i(this,"index",0);i(this,"tableHeader",[])}mounted(){this.initSnapshotName(),this.search()}async CleanupeRepository(t){const a={};a.es_connect=y.GetSelectEsConnID(),a.name=t;const{data:r,code:n,msg:u}=await q(a);if(n!=0){_.error({type:"error",message:u});return}else{this.initSnapshotName(),this.search(),_.success({type:"success",message:u});return}}async SnapshotDeleteRepositoryAction(t){const a={};a.es_connect=y.GetSelectEsConnID(),a.name=t;const{data:r,code:n,msg:u}=await J(a);if(n!=0){_.error({type:"error",message:u});return}else{this.initSnapshotName(),this.search(),_.success({type:"success",message:u});return}}updateSnapshotData(t){this.snapshotData=t,this.openAddDialog=!0}closeAddDialog(t){this.openAddDialog=!1,this.snapshotData=null,t&&(this.initSnapshotName(),this.search())}async initSnapshotName(){this.loading=!0;const t={};t.es_connect=y.GetSelectEsConnID();const{data:a,code:r,msg:n}=await $(t);r==0?(this.resData=a.res,v({title:"成功",dangerouslyUseHTMLString:!0,message:`
<strong> <b style="color: orange">您设置的path.repo为${a.pathRepo.join(",")}</b><br></strong>
          `,type:"success"})):r==199999?v({title:"Error",dangerouslyUseHTMLString:!0,message:`
<strong>
            <i style="color: orange">path.repo没有设置</i><br>
<i>在elasticsearch.yml 配置文件中配置仓库base目录</i><br>
<i>添加path.repo: /tmp/tmp (/tmp/tmp 为快照备份所在文件夹, <br><i style="color: orange">注意</i>首先要先创建这个文件夹)</i>

          `,type:"error"}):_.error({type:"error",message:n}),this.loading=!1}async search(){const t={};t.es_connect=y.GetSelectEsConnID(),t.snapshot_info_list=this.snapshotNameList,t.repository="test3";const{data:a,code:r,msg:n}=await $(t);if(r!=0){if(r!=199999){_.error({type:"error",message:n});return}}else this.tableData=a.list}openDetail(t,a,r){this.name=t.name,this.drawerShow=!0}look(t){this.name=t,this.drawerShow=!0}drawerHandleClose(t){t()}};C=X([M({name:"Task",components:{},setup(){return{ctx:I().appContext.config.globalProperties}}})],C);const Y=j(C);const Z={class:"app-container"},x={class:"search-container"},ee={key:0},te={key:1},ae={key:0},se={key:1};function oe(e,t,a,r,n,u){const b=d("el-option"),S=d("el-select"),D=d("el-form-item"),w=d("el-button"),A=d("el-form"),p=d("el-table-column"),B=d("el-button-group"),k=d("el-table"),F=d("el-card"),N=d("el-drawer"),V=O("loading");return c(),g("div",Z,[P("div",x,[s(A,{inline:!0},{default:l(()=>[s(D,{label:"存储库"},{default:l(()=>[T((c(),E(S,{style:{width:"10rem"},modelValue:e.snapshotNameList,"onUpdate:modelValue":t[0]||(t[0]=o=>e.snapshotNameList=o),clearable:"",filterable:"",multiple:"",placeholder:e.$t("请选择存储库"),onChange:e.search},{default:l(()=>[(c(!0),g(G,null,U(e.resData,(o,h,L)=>(c(),E(b,{key:L,label:h,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"])),[[V,e.loading]])]),_:1}),s(D,null,{default:l(()=>[s(w,{type:"warning",onClick:t[1]||(t[1]=o=>e.openAddDialog=!0)},{default:l(()=>[f(m(e.$t("新建存储库")),1)]),_:1})]),_:1})]),_:1})]),s(F,{shadow:"never",class:"table-container"},{default:l(()=>[s(k,{data:e.tableData},{default:l(()=>[s(p,{label:e.$t("序号"),align:"center",fixed:"",width:"100"},{default:l(o=>[f(m(o.$index+1),1)]),_:1},8,["label"]),s(p,{align:"center",label:e.$t("存储库名"),prop:"name",width:"200"},null,8,["label"]),s(p,{align:"center",label:e.$t("存储库地址"),prop:"location",width:"300"},null,8,["label"]),s(p,{align:"center",label:e.$t("类型"),prop:"type",width:"200"},null,8,["label"]),s(p,{align:"center",label:e.$t("是否压缩"),prop:"compress",width:"100"},null,8,["label"]),s(p,{align:"center",label:e.$t("分解块大小"),prop:"chunk_size",width:"100"},null,8,["label"]),s(p,{align:"center",label:e.$t("是否只读(默认false)"),prop:"readonly",width:"100"},null,8,["label"]),s(p,{align:"center",label:e.$t("制作快照的速度"),width:"100"},{default:l(o=>[o.row.max_snapshot_bytes_per_sec!=""?(c(),g("div",ee,m(o.row.max_snapshot_bytes_per_sec)+"/s",1)):(c(),g("div",te,"20mb/s"))]),_:1},8,["label"]),s(p,{align:"center",label:e.$t("快照恢复的速度"),width:"100"},{default:l(o=>[o.row.max_restore_bytes_per_sec!=""?(c(),g("div",ae,m(o.row.max_restore_bytes_per_sec)+"/s",1)):(c(),g("div",se,"20mb/s"))]),_:1},8,["label"]),s(p,{align:"center",label:e.$t("操作"),fixed:"right",width:"350"},{default:l(o=>[s(B,null,{default:l(()=>[s(w,{type:"success",onClick:h=>e.look(o.row.name)},{default:l(()=>[f(m(e.$t("查看")),1)]),_:2},1032,["onClick"]),s(w,{type:"warning",onClick:h=>e.updateSnapshotData(o.row)},{default:l(()=>[f(m(e.$t("修改")),1)]),_:2},1032,["onClick"]),s(w,{type:"danger",onClick:h=>e.SnapshotDeleteRepositoryAction(o.row.name)},{default:l(()=>[f(m(e.$t("删除")),1)]),_:2},1032,["onClick"]),s(w,{type:"warning",onClick:h=>e.CleanupeRepository(o.row.name)},{default:l(()=>[f(m(e.$t("清理")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),s(N,{ref:"drawer",title:e.$t("JSON数据"),"before-close":e.drawerHandleClose,modelValue:e.drawerShow,"onUpdate:modelValue":t[2]||(t[2]=o=>e.drawerShow=o),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},null,8,["title","before-close","modelValue"])])}const pe=K(Y,[["render",oe],["__scopeId","data-v-e026fe55"]]);export{pe as default};
