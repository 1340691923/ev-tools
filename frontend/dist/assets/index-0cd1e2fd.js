import{j as De,C as ke,f as xe}from"./es-658caece.js";import{G as Se,D as Ce}from"./es-index-6058f406.js";import{n as Ve,r as Me,i as Ye,c as Le,d as je,L as fe}from"./es-map-b93b3519.js";import{U as Te,I as Ne,D as Oe,K as Ue}from"./style-8fe7fac7.js";import{b as S,N as W,f as ye,r as c,o as s,k as v,R as he,c as g,h as u,a as i,w as r,F as L,q as B,t as j,u as z,i as O,x as U,S as pe,y as me,p as Ie,E as x,D as Ae,G as Ee,B as ve,L as ie,g as ge,s as E,O as be,z as we,A as ne,e as le,T as ze}from"./index-43868d38.js";import{J as se}from"./index-a6836423.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{c as Be}from"./index-0aae8c1b.js";const oe={shortcuts:[{text:"今天",value:()=>[dayjs().format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"昨天",value:()=>[dayjs().subtract(-1,"day").format("YYYY-MM-DD 00:00:00"),dayjs().subtract(-1,"day").format("YYYY-MM-DD 23:59:59")]},{text:"一周",value:()=>[dayjs().subtract(-7,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"两周",value:()=>[dayjs().subtract(-14,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一月",value:()=>[dayjs().subtract(-30,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"三个月",value:()=>[dayjs().subtract(-90,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"半年",value:()=>[dayjs().subtract(-180,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一年",value:()=>[dayjs().subtract(-360,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]}]},Ge={name:"Values",props:{data:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""}},setup(e,{emit:l}){const a=S([]),n=S(e.value),t=()=>{n.value=[],l("update:value",n.value)},o=()=>{l("update:value",n.value)},D=y=>{a.value=[]};return W(()=>e.data,y=>{D()}),W(n,y=>{l("update:value",y)}),ye(()=>{D(e.data)}),{options:a,selectVal:n,cleanValues:t,changeValue:o}}};function Re(e,l,a,n,t,o){const D=c("el-select");return s(),v(D,{"collapse-tags-tooltip":"",modelValue:n.selectVal,"onUpdate:modelValue":l[0]||(l[0]=y=>n.selectVal=y),filterable:"",options:n.options,placeholder:"请输入筛选值",style:{width:"240px"},multiple:"","default-first-option":"","allow-create":"","collapse-tags":"","reserve-keyword":!1,clearable:""},null,8,["modelValue","options"])}const $e=X(Ge,[["render",Re]]),Je={class:"ta-filter-condition"},Pe={style:{float:"left"}},Fe={style:{float:"right",color:"#8492a6","font-size":"13px"}},_e={__name:"ActionRow",props:{value:{type:Object,default:()=>({})},datas:{type:Object,default:()=>({})},options:{type:Array,default:()=>[]},dataTypeMap:{type:Array,default:()=>[]},tableTyp:{type:Number,default:0}},emits:["update:value"],setup(e,{emit:l}){const a=e,n=l,t=he(a.value),o=S(oe);W(()=>t.columnName,()=>{n("update:value",t)}),W(()=>t.comparator,()=>{n("update:value",t)}),W(()=>t.ftv,()=>{n("update:value",t)}),ye(()=>{o.value=oe});const D=C=>{let p=0;if(a.dataTypeMap.hasOwnProperty(a.tableTyp.toString()))for(const T of a.dataTypeMap[a.tableTyp.toString()])C===T.attribute_name&&(p=T.data_type);return je[p]},y=()=>{const C=D(t.columnName);for(const p in C){t.comparator=p;break}n("update:value",t)};return(C,p)=>{const T=c("el-option"),M=c("el-option-group"),I=c("el-select"),N=c("el-input"),b=c("el-date-picker");return s(),g("div",null,[u("div",Je,[i(I,{modelValue:t.columnName,"onUpdate:modelValue":p[0]||(p[0]=m=>t.columnName=m),filterable:"",style:{width:"300px"},placeholder:"请选择",onChange:y},{default:r(()=>[(s(!0),g(L,null,B(e.options,m=>(s(),v(M,{key:m.label,label:m.label},{default:r(()=>[(s(!0),g(L,null,B(m.options,w=>(s(),v(T,{key:w.value,label:w.label,value:w.value},{default:r(()=>[u("span",Pe,j(w.label),1),u("span",Fe,j(w.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),i(I,{modelValue:t.comparator,"onUpdate:modelValue":p[1]||(p[1]=m=>t.comparator=m),style:{width:"80px"}},{default:r(()=>[(s(!0),g(L,null,B(D(t.columnName),(m,w,A)=>(s(),v(T,{key:A,label:m,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),z(Ve).includes(t.comparator)?(s(),g(L,{key:0},[],64)):z(Me).includes(t.comparator)?(s(),g(L,{key:1},[i(N,{modelValue:t.ftv[0],"onUpdate:modelValue":p[2]||(p[2]=m=>t.ftv[0]=m),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"]),O(" ~ "),i(N,{modelValue:t.ftv[1],"onUpdate:modelValue":p[3]||(p[3]=m=>t.ftv[1]=m),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"])],64)):z(Ye).includes(t.comparator)?(s(),v(N,{key:2,modelValue:t.ftv,"onUpdate:modelValue":p[4]||(p[4]=m=>t.ftv=m),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):z(Le).includes(t.comparator)?(s(),v(b,{key:3,modelValue:t.ftv,"onUpdate:modelValue":p[5]||(p[5]=m=>t.ftv=m),type:"datetimerange",align:"right","default-time":["00:00:00","23:59:59"],"unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":z(oe)},null,8,["modelValue","picker-options"])):t.comparator=="match"?(s(),v(N,{key:4,modelValue:t.ftv,"onUpdate:modelValue":p[6]||(p[6]=m=>t.ftv=m),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):(s(),v($e,{key:5,ref:"values",modelValue:t.ftv,"onUpdate:modelValue":p[7]||(p[7]=m=>t.ftv=m),"table-typ":e.tableTyp,style:{width:"300px"},data:t.columnName},null,8,["modelValue","table-typ","data"]))])])}}};const re=e=>(Ae("data-v-5e3c0ee4"),e=e(),Ee(),e),He={class:"xwl_main",style:{"margin-top":"20px"}},qe={class:"relation-editor globalFilters_xwl"},Ke={class:"relation-relation"},We=re(()=>u("em",{class:"relation-relation-line"},null,-1)),Qe={class:"relation-main"},Xe={class:"ta-multa-filter-condition"},Ze={key:0,class:"action-row row___xwl"},et={class:"action-right"},tt={key:1,class:"relation-editor"},at={class:"relation-relation"},lt=re(()=>u("div",{class:"relation-relation-sub"},"◆",-1)),ot=re(()=>u("em",{class:"relation-relation-line-sub"},null,-1)),nt=["onClick"],st={class:"relation-main"},it={class:"relation-row"},rt={class:"action-left"},dt={class:"action-right"},ut={style:{padding:"0 12px"}},ct={__name:"index",props:{value:{type:Object,default:()=>({relationLine:"且",relationArr:[],ftv:[]})},fontColor:{type:String,default:"#3d90ff"},tableTyp:{type:Number,default:0},dataTypeMap:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:l}){const a=e,n=l,t=S(!0),o=he({...a.value}),D=()=>{t.value=!1,ve(()=>{t.value=!0})},y=b=>{const m=o.filts[b],w={filterType:"COMPOUND",filts:[],relation:"且"};w.filts.push(m),w.filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),o.filts[b]=w,n("update:value",o)},C=b=>{o.filts[b].filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),n("update:value",o)},p=(b,m)=>{if(o.filts[b].filts.length>2)o.filts[b].filts.splice(m,1);else{const w=[...o.filts[b].filts];w.splice(m,1);const A=w[0];o.filts[b]=A}n("update:value",o)},T=()=>{if(a.options.length==0){n("update:value",o),x({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}if(a.options[0].options.length===0){n("update:value",o),x({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}o.filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),n("update:value",o)},M=b=>{o.filts.splice(b,1),n("update:value",o),D()},I=()=>{o.relation=o.relation==="或"?"且":"或",n("update:value",o)},N=b=>{o.filts[b].relation=o.filts[b].relation==="或"?"且":"或",n("update:value",o)};return(b,m)=>{const w=c("el-button"),A=c("el-button-group");return s(),g("div",null,[u("div",He,[u("div",qe,[u("div",Ke,[We,o.filts.length>1?(s(),g("div",{key:0,class:"relation-relation-value",onClick:I},j(o.relation),1)):U("",!0)]),u("div",Qe,[(s(!0),g(L,null,B(o.filts,(G,Y)=>(s(),g("div",{key:Y,class:"relation-row"},[u("div",Xe,[G.filterType==="SIMPLE"?(s(),g("div",Ze,[t.value?(s(),v(_e,{key:0,value:o.filts[Y],"onUpdate:value":P=>o.filts[Y]=P,options:a.options,"table-typ":a.tableTyp,"data-type-map":a.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"])):U("",!0),u("div",et,[i(A,null,{default:r(()=>[i(w,{type:"link",class:"actions_xwl_btn",onClick:()=>y(Y),icon:z(pe)},null,8,["onClick","icon"]),i(w,{type:"link",class:"actions_xwl_btn",icon:z(me),onClick:()=>M(Y)},null,8,["icon","onClick"])]),_:2},1024)])])):(s(),g("div",tt,[u("div",at,[lt,ot,u("div",{class:"relation-relation-value",onClick:()=>N(Y)},j(G.relation),9,nt)]),u("div",st,[u("div",it,[(s(!0),g(L,null,B(G.filts,(P,R)=>(s(),g("div",{key:R,class:"action-row row___xwl"},[u("div",rt,[(s(),v(_e,{key:(Y+"_"+R).toString(),value:G.filts[R],"onUpdate:value":q=>G.filts[R]=q,options:a.options,"table-typ":a.tableTyp,"data-type-map":a.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"]))]),u("div",dt,[i(A,null,{default:r(()=>[i(w,{type:"link",class:"actions_xwl_btn",onClick:()=>C(Y),icon:z(pe)},null,8,["onClick","icon"]),i(w,{type:"link",class:"actions_xwl_btn",icon:z(me),onClick:()=>p(Y,R)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])])]))])]))),128))])])]),u("div",ut,[u("span",{style:Ie({color:a.fontColor}),class:"footadd___2D4YB",onClick:T},j(b.$t("增加条件")),5)])])}}},pt=X(ct,[["__scopeId","data-v-5e3c0ee4"]]),de="/api/es_crud/";function mt(e){return ie({url:de+"GetList",method:"post",transformResponse:[l=>De.parse(l)],data:e})}function _t(e){return ie({url:de+"GetDSL",method:"post",data:e})}function ft(e){return ie({responseType:"arraybuffer",url:de+"Download",method:"post",data:e})}const yt={name:"Crud",setup(){return{ctx:ge().appContext.config.globalProperties}},components:{JsonEditor:se,FilterWhere:pt},computed:{jsonDataString(){return JSON.stringify(this.jsonData,null,"	")},queryDslString(){return JSON.stringify(this.queryDsl,null,"	")}},props:{indexName:{type:String,default:"test2"},attrMapProp:{type:Array,default:[]},eventAttrOptionsProp:{type:Array,default:[]}},data(){return{ctx:null,showJsonEditor1:!1,showJsonEditor2:!1,properties:{},openAddDialog:!1,tableLoading:!1,tableHeader:[],tableData:[],crudTab:"filter",eventAttrOptions:this.eventAttrOptionsProp,attrMap:this.attrMapProp,whereFilter:{filterType:"COMPOUND",filts:[],relation:"且"},sortList:[],input:{page:1,limit:20},count:0,typName:"",newDoc:{},jsonData:{},tableDataClone:[],drawerShow:!1,queryDslShow:!1,queryDsl:{},downloadLoading:!1}},mounted(){this.indexName!=""&&this.search(1)},methods:{download(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:E.GetSelectEsConnID()},l=document.createElement("a");this.downloadLoading=!0,ft(e).then(a=>{if(a){const n=new Blob([a],{type:"application/vnd.ms-excel"}),t=URL.createObjectURL(n);l.href=t,l.download=this.indexName+".csv",l.click(),URL.revokeObjectURL(t)}this.downloadLoading=!1}).catch(a=>{this.downloadLoading=!1,console.error(a)})},drawerShowFn(){this.drawerShow=!1,this.$nextTick(()=>{this.drawerShow=!0,this.$nextTick(()=>{this.showJsonEditor1=!0})})},look(e){this.index=e,console.log("this.tableDataClone",this.tableDataClone),this.jsonData=this.tableDataClone[e],this.drawerShowFn()},async updateByID(){console.log("this.jsonData",this.jsonData);const e=this.jsonData,l=e._source,a={};a.es_connect=E.GetSelectEsConnID(),a.index=e._index,a.type_name=e._type,a.id=e._id,a.json=l;const n=await Te(a);n.code==0?(this.search(1),x({type:"success",message:n.msg})):x({type:"error",message:n.msg})},getEditDoc(e){try{const l=JSON.parse(e);this.jsonData=l}catch{}},getNewDoc(e){try{this.newDoc=JSON.parse(e)}catch{}},async add(){const e=this.newDoc,l={};l.es_connect=E.GetSelectEsConnID(),l.index=this.indexName,l.type_name=this.typName,l.json=e;const a=await Ne(l);a.code==0?x({type:"success",message:a.msg+"(_id为:"+a.data._id+")",duration:2e4}):x({type:"error",message:a.msg})},drawerHandleClose(e){e()},async deleteByID(e,l){be.confirm("确定删除ID为【"+e._id+"】的这条文档吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a={};a.es_connect=E.GetSelectEsConnID(),a.index_name=this.indexName,a.type=this.typName,a.id=e._id;const n=await Oe(a);n.code==0?setTimeout(async()=>{await this.search(1),x({type:"success",message:n.msg})},1e3):x({type:"error",message:n.msg})}).catch(a=>{console.error(a)})},async initTableData(e){if(e.hasOwnProperty("hits")&&e.hits.hits.length>0){this.typName=e.hits.hits[0]._type;const l=[];this.tableDataClone=Be(e.hits.hits);for(const a in e.hits.hits){const n=e.hits.hits[a]._source;n._id=e.hits.hits[a]._id,n._score=e.hits.hits[a]._score,n.xwl_index=a,l.push(n)}this.tableData=l;for(const a in this.tableData)for(const n in this.tableData[a])(typeof this.tableData[a][n]=="object"||typeof this.tableData[a][n]=="array")&&(this.tableData[a][n]=JSON.stringify(this.tableData[a][n]))}this.$nextTick(()=>{this.$refs.multipleTable.doLayout()})},async getMapping(){const e={};e.es_connect=E.GetSelectEsConnID(),e.index_name=this.indexName;const{data:l,code:a,msg:n}=await fe(e);if(a==0){if(l.ver==6){const t=Object.keys(l.list[e.index_name].mappings);for(const y in t)if(t[y]=="_default_"){t.splice(y,1);break}const o=Object.keys(l.list[e.index_name].mappings[t[0]].properties);this.properties=l.list[e.index_name].mappings[t[0]].properties;const D=[];D.push("_id");for(const y in o)o[y]!="_id"&&D.push(o[y]);this.tableHeader=D}else if(l.ver==7||l.ver==8){if(JSON.stringify(l.list[e.index_name].mappings)=="{}"){x({type:"error",message:"该索引没有设置映射结构"});return}const t=Object.keys(l.list[e.index_name].mappings.properties);this.properties=l.list[e.index_name].mappings.properties;const o=[];o.push("_id");for(const D in t)t[D]!="_id"&&o.push(t[D]);this.tableHeader=o}}else x({type:"error",message:n})},pushSort(){this.sortList.push({col:"",sortRule:"desc"})},deleteSort(e){this.sortList.splice(e,1)},handleSizeChange(e){this.input.limit=e,this.search(1)},async getdsl(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:E.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},l=await _t(e);if(l.code!=0){x({type:"error",message:l.msg});return}this.queryDsl=l.data.list,this.queryDslShow=!0,this.$nextTick(()=>{this.showJsonEditor2=!0})},async search(e){this.tableLoading=!0,e?this.input.page=e:this.input.page=1;const l={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:E.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},a=await mt(l);if(a.code!=0){x({type:"error",message:a.msg}),this.tableData=[],this.tableLoading=!1;return}this.count=a.data.count,await this.getMapping(),this.count>0?await this.initTableData(a.data.list):this.tableData=[],this.tableLoading=!1}}},ht={class:"app-container",style:{height:"95%"}},vt={class:"search-container"},gt={class:"search-container"},bt={class:"relation-row"},wt={class:"action-left"},Dt={style:{float:"left"}},kt={style:{float:"right",color:"#8492a6","font-size":"13px"}},xt={style:{padding:"0 12px"}},St={class:"search-container"},Ct={key:1,style:{padding:"40px",width:"300px",height:"800px","text-align":"center",margin:"0px auto",position:"relative",top:"30%"}};function Vt(e,l,a,n,t,o){const D=c("filter-where"),y=c("el-tab-pane"),C=c("el-option"),p=c("el-option-group"),T=c("el-select"),M=c("el-button"),I=c("el-tabs"),N=c("el-table-column"),b=c("el-button-group"),m=c("el-table"),w=c("el-pagination"),A=c("el-card"),G=c("el-tag"),Y=c("json-editor"),P=c("el-drawer"),R=c("el-empty"),q=we("loading");return s(),g("div",null,[u("div",ht,[a.indexName!=""?(s(),g(L,{key:0},[u("div",vt,[i(I,{modelValue:t.crudTab,"onUpdate:modelValue":l[2]||(l[2]=f=>t.crudTab=f)},{default:r(()=>[i(y,{lazy:!0,label:e.$t("筛选"),name:"filter"},{default:r(()=>[i(D,{value:t.whereFilter,"onUpdate:value":l[0]||(l[0]=f=>t.whereFilter=f),"table-typ":"2","data-type-map":t.attrMap,options:t.eventAttrOptions},null,8,["value","data-type-map","options"])]),_:1},8,["label"]),i(y,{lazy:"true",label:e.$t("排序"),name:"sort"},{default:r(()=>[u("div",gt,[u("div",bt,[(s(!0),g(L,null,B(t.sortList,(f,_)=>(s(),g("div",{key:_,class:"action-row row___xwl"},[u("div",wt,[i(T,{modelValue:t.sortList[_].col,"onUpdate:modelValue":d=>t.sortList[_].col=d,filterable:"",style:{width:"300px","margin-left":"30px"},placeholder:e.$t("请选择")},{default:r(()=>[(s(!0),g(L,null,B(a.eventAttrOptionsProp,d=>(s(),v(p,{key:d.label,label:d.label},{default:r(()=>[(s(!0),g(L,null,B(d.options,h=>(s(),v(C,{key:h.value,label:h.label,value:h.value},{default:r(()=>[u("span",Dt,j(h.label),1),u("span",kt,j(h.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),i(T,{modelValue:t.sortList[_].sortRule,"onUpdate:modelValue":d=>t.sortList[_].sortRule=d,style:{width:"100px","margin-left":"30px"},placeholder:e.$t("请选择排序规则"),filterable:""},{default:r(()=>[i(C,{label:e.$t("正序排"),value:"asc"},null,8,["label"]),i(C,{label:e.$t("倒序排"),value:"desc"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),i(M,{style:{"margin-left":"30px"},class:"actions_xwl_btn",onClick:d=>o.deleteSort(_)},{default:r(()=>[O("删除")]),_:2},1032,["onClick"])])]))),128))])]),u("div",xt,[u("span",{style:{color:"#3d90ff"},class:"footadd___2D4YB",onClick:l[1]||(l[1]=(...f)=>o.pushSort&&o.pushSort(...f))},j(e.$t("增加排序")),1)])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),i(A,{class:"box-card"},{default:r(()=>[u("div",St,[i(M,{type:"warning",onClick:l[3]||(l[3]=f=>o.getdsl(1))},{default:r(()=>[O("查看查询语句 ")]),_:1}),i(M,{type:"success",onClick:l[4]||(l[4]=f=>o.search(1))},{default:r(()=>[O("查询 ")]),_:1}),i(M,{disabled:t.downloadLoading,loading:t.downloadLoading,type:"primary",onClick:l[5]||(l[5]=f=>o.download())},{default:r(()=>[O("下载 ")]),_:1},8,["disabled","loading"])]),ne((s(),v(m,{height:"400",data:t.tableData,"use-virtual":"",ref:"multipleTable","row-height":30,"show-overflow-tooltip":""},{default:r(()=>[i(N,{label:"ID",align:"center",fixed:"","min-width":"100",prop:"_id"}),(s(!0),g(L,null,B(t.tableHeader,(f,_)=>(s(),g(L,null,[f!="xwl_index"&&f!="_id"?(s(),v(N,{key:0,prop:f,sortable:!0,align:"center",label:f},null,8,["prop","label"])):U("",!0)],64))),256)),i(N,{align:"center",label:e.$t("操作"),fixed:"right",width:"200"},{default:r(f=>[i(b,null,{default:r(()=>[i(M,{type:"primary",onClick:_=>o.look(f.$index)},{default:r(()=>[O(" 编辑 ")]),_:2},1032,["onClick"]),i(M,{type:"danger",onClick:_=>o.deleteByID(f.row,f.$index)},{default:r(()=>[O(j(e.$t("删除")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[q,t.tableLoading]]),i(w,{"current-page":t.input.page,"page-sizes":[10,20,30,50,100,150,200],"page-size":t.input.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.count,onSizeChange:o.handleSizeChange,onCurrentChange:o.search},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),i(P,{ref:"drawer",title:"详细数据","before-close":o.drawerHandleClose,modelValue:t.drawerShow,"onUpdate:modelValue":l[7]||(l[7]=f=>t.drawerShow=f),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},{default:r(()=>[i(G,null,{default:r(()=>[O("操作")]),_:1}),i(M,{type:"primary",onClick:o.updateByID},{default:r(()=>[O("修改 ")]),_:1},8,["onClick"]),t.showJsonEditor1?(s(),v(Y,{key:0,value:o.jsonDataString,"onUpdate:value":l[6]||(l[6]=f=>o.jsonDataString=f),height:"900",class:"res-body",styles:"width: 100%",title:"详细数据",onGetValue:o.getEditDoc},null,8,["value","onGetValue"])):U("",!0)]),_:1},8,["before-close","modelValue"]),i(P,{ref:"drawer",title:"查询DSL","before-close":o.drawerHandleClose,modelValue:t.queryDslShow,"onUpdate:modelValue":l[9]||(l[9]=f=>t.queryDslShow=f),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},{default:r(()=>[t.showJsonEditor2?(s(),v(Y,{key:0,value:o.queryDslString,"onUpdate:value":l[8]||(l[8]=f=>o.queryDslString=f),height:"900",class:"res-body",styles:"width: 100%",title:"DSL",read:!0},null,8,["value"])):U("",!0)]),_:1},8,["before-close","modelValue"])],64)):(s(),g("div",Ct,[i(R,{content:"请先点击左侧索引名称"})]))])])}const Mt=X(yt,[["render",Vt],["__scopeId","data-v-7471efec"]]);const Yt={style:{display:"flex","justify-content":"space-between"}},Lt={class:"content_xwl"},jt={id:"scollL",style:{height:"100%",width:"100%",display:"inline-block","vertical-align":"top"}},Tt={style:{width:"100%",height:"calc(100% - 80px)","overflow-x":"hidden","overflow-y":"auto",padding:"10px"}},Nt={class:"el-dropdown-link"},Ot={slot:"title"},Ut={style:{width:"100%",height:"calc(100% - 80px)","overflow-x":"hidden","overflow-y":"auto",padding:"10px"}},It={style:{height:"100%",width:"100%",display:"inline-block","vertical-align":"top"}},At={__name:"index",setup(e){ge().appContext.config.globalProperties;const l=S([]),a=S({}),n=S(!1),t=S(!0),o=S("settings"),D=S(!1),y=S([]),C=S(""),p=S(""),T=S({}),M=S([]),I=S(!1),N=S([]),b=le(()=>C.value===""?y.value:xe(y.value,C.value)),m=le(()=>JSON.stringify(T.value,null,"	")),w=le(()=>JSON.stringify(a.value,null,"	")),A=()=>{t.value=!1,ve(()=>{t.value=!0})},G=async _=>{p.value=_;const d={es_connect:E.GetSelectEsConnID(),index_name:p.value};n.value=!0,console.log("123");try{const h=await fe(d);if(h.code!==0){n.value=!1,x.error(h.msg);return}const V=await Se(d);if(V.code!==0){n.value=!1,x.error(V.msg);return}a.value=h.data.list;const $=[{label:"筛选字段",options:[]}],K={2:[]};let F={};switch(h.data.ver){case 6:F=a.value[p.value].mappings[Object.keys(a.value[p.value].mappings)[0]].properties;break;case 7:case 8:F=a.value[p.value].mappings.properties;break}const Z=1,ee=2,te=3,Q=5;for(const J in F)if(F[J].type){$[0].options.push({value:J,label:J});const H={attribute_name:J,show_name:J};switch(F[J].type){case"text":H.data_type=Q;break;case"keyword":H.data_type=te;break;case"byte":case"short":case"integer":case"long":H.data_type=Z;break;case"float":case"half_float":case"scaled_float":case"double":H.data_type=ee;break}K[2].push(H)}N.value=K,M.value=$,T.value=V.data,n.value=!1,A()}catch(h){n.value=!1,x.error("An error occurred while fetching data.",h)}},Y=_=>{const d=y.value.findIndex(h=>h.k.toString()===_.toString());d!==-1&&y.value.splice(d,1)},P=async(_,d)=>{try{await be.confirm("删除该索引不可恢复，确认删除吗？",$t("警告"),{confirmButtonText:$t("确定"),cancelButtonText:$t("取消"),type:"warning"})}catch{return}const h=await Ce({es_connect:E.GetSelectEsConnID(),index_name:d});h.code!==0?x({type:"error",message:h.msg}):(Y(_),x({type:"success",message:h.msg}))};ze(async()=>{R()});const R=async()=>{const _={cat:"CatIndices",es_connect:E.GetSelectEsConnID()};y.value=[],D.value=!0,l.value=[];const d=await ke(_);if(d.code!=0){x({type:"error",message:d.msg}),D.value=!1;return}for(const h in d.data){const V=d.data[h],$={health:V.health,index:V.index,k:h,storeSize:V["store.size"],docsCount:V["docs.count"]};y.value.push($),l.value.push({value:V.index,data:V.index})}D.value=!1},q=(_,d)=>{const h=_?l.value.filter(f(_)):l.value;d(h)},f=_=>d=>d.value.toLowerCase().includes(_.toLowerCase());return(_,d)=>{const h=c("el-autocomplete"),V=c("Grid"),$=c("el-icon"),K=c("el-dropdown-item"),F=c("el-dropdown-menu"),Z=c("el-dropdown"),ee=c("el-menu-item"),te=c("el-menu"),Q=c("el-tab-pane"),J=c("el-tabs"),H=c("el-drawer"),ue=we("loading");return s(),g("div",Yt,[u("div",Lt,[i(z(Ue),{style:{"margin-top":"3px"},distribute:.14,lineThickness:6,isVertical:!0},{first:r(()=>[u("div",jt,[u("div",Tt,[i(h,{modelValue:C.value,"onUpdate:modelValue":d[0]||(d[0]=k=>C.value=k),style:{width:"90%"},clearable:"","fetch-suggestions":q,placeholder:_.$t("请输入索引名")},{default:r(({item:k})=>[u("span",null,j(k.value),1)]),_:1},8,["modelValue","placeholder"]),ne((s(),v(te,{style:{"margin-top":"10px"}},{default:r(()=>[(s(!0),g(L,null,B(b.value,(k,ae)=>(s(),v(ee,{index:ae.toString(),onClick:ce=>G(k.index)},{default:r(()=>[i(Z,null,{dropdown:r(()=>[i(F,null,{default:r(()=>[i(K,{onClick:ce=>P(b.value[ae].k,b.value[ae].index)},{default:r(()=>[O(j(_.$t("删除")),1)]),_:2},1032,["onClick"]),i(K,{onClick:d[1]||(d[1]=ce=>I.value=!0)},{default:r(()=>[O(j(_.$t("结构")),1)]),_:1})]),_:2},1024)]),default:r(()=>[u("span",Nt,[k.health=="red"?(s(),v($,{key:0,style:{color:"red"}},{default:r(()=>[i(V)]),_:1})):U("",!0),k.health=="green"?(s(),v($,{key:1,style:{color:"#13ce66"}},{default:r(()=>[i(V)]),_:1})):U("",!0),k.health=="yellow"?(s(),v($,{key:2,style:{color:"#ffba00"}},{default:r(()=>[i(V)]),_:1})):U("",!0)])]),_:2},1024),u("span",Ot,j(k.index)+"【"+j(k.storeSize)+"】",1)]),_:2},1032,["index","onClick"]))),256))]),_:1})),[[ue,D.value]])])])]),second:r(()=>[u("div",Ut,[t.value?(s(),v(Mt,{key:0,"attr-map-prop":N.value,"event-attr-options-prop":M.value,"index-name":p.value},null,8,["attr-map-prop","event-attr-options-prop","index-name"])):U("",!0)]),i(H,{ref:"drawer",title:_.$t("索引结构"),modelValue:I.value,"onUpdate:modelValue":d[5]||(d[5]=k=>I.value=k),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},{default:r(()=>[u("div",It,[ne((s(),v(J,{modelValue:o.value,"onUpdate:modelValue":d[4]||(d[4]=k=>o.value=k),type:"border-card"},{default:r(()=>[i(Q,{lazy:!0,label:_.$t("索引设置"),name:"settings"},{default:r(()=>[t.value?(s(),v(se,{key:0,value:m.value,"onUpdate:value":d[2]||(d[2]=k=>m.value=k),height:"720",styles:"width: 100%",read:!0,title:p.value},null,8,["value","title"])):U("",!0)]),_:1},8,["label"]),i(Q,{lazy:!0,label:_.$t("映射结构"),name:"mappings"},{default:r(()=>[t.value?(s(),v(se,{key:0,value:w.value,"onUpdate:value":d[3]||(d[3]=k=>w.value=k),height:"720",styles:"width: 100%",read:!0,title:p.value},null,8,["value","title"])):U("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])),[[ue,n.value]])])]),_:1},8,["title","modelValue"])]),_:1})])])}}},Ht=X(At,[["__scopeId","data-v-a0648cf4"]]);export{Ht as default};
