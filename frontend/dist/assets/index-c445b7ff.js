import{j as we,C as ke,f as De}from"./es-155edf90.js";import{G as xe,D as Se}from"./es-index-d77ba448.js";import{n as Ce,r as Ve,i as Me,c as Ye,d as je,L as _e}from"./es-map-864ea611.js";import{U as Le,I as Ne,D as Te,K as Oe}from"./style-409defd8.js";import{b as S,M as K,f as fe,r as c,o as i,l as y,Q as ye,c as h,k as u,a as r,w as d,F as Y,s as G,t as j,u as B,h as U,x as I,R as ce,y as pe,q as Ue,E as x,D as Ie,G as Ae,B as he,i as T,g as ve,N as ge,z as be,A as ne,e as le,S as Ee}from"./index-ff273ca0.js";import{J as se}from"./index-02fd6334.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import{c as ze}from"./index-0aae8c1b.js";const oe={shortcuts:[{text:"今天",value:()=>[dayjs().format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"昨天",value:()=>[dayjs().subtract(-1,"day").format("YYYY-MM-DD 00:00:00"),dayjs().subtract(-1,"day").format("YYYY-MM-DD 23:59:59")]},{text:"一周",value:()=>[dayjs().subtract(-7,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"两周",value:()=>[dayjs().subtract(-14,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一月",value:()=>[dayjs().subtract(-30,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"三个月",value:()=>[dayjs().subtract(-90,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"半年",value:()=>[dayjs().subtract(-180,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一年",value:()=>[dayjs().subtract(-360,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]}]},Be={name:"Values",props:{data:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""}},setup(e,{emit:l}){const a=S([]),s=S(e.value),t=()=>{s.value=[],l("update:value",s.value)},o=()=>{l("update:value",s.value)},w=f=>{a.value=[]};return K(()=>e.data,f=>{w()}),K(s,f=>{l("update:value",f)}),fe(()=>{w(e.data)}),{options:a,selectVal:s,cleanValues:t,changeValue:o}}};function Ge(e,l,a,s,t,o){const w=c("el-select");return i(),y(w,{"collapse-tags-tooltip":"",modelValue:s.selectVal,"onUpdate:modelValue":l[0]||(l[0]=f=>s.selectVal=f),filterable:"",options:s.options,placeholder:"请输入筛选值",style:{width:"240px"},multiple:"","default-first-option":"","allow-create":"","collapse-tags":"","reserve-keyword":!1,clearable:""},null,8,["modelValue","options"])}const Re=W(Be,[["render",Ge]]),$e={class:"ta-filter-condition"},Je={style:{float:"left"}},Pe={style:{float:"right",color:"#8492a6","font-size":"13px"}},me={__name:"ActionRow",props:{value:{type:Object,default:()=>({})},datas:{type:Object,default:()=>({})},options:{type:Array,default:()=>[]},dataTypeMap:{type:Array,default:()=>[]},tableTyp:{type:Number,default:0}},emits:["update:value"],setup(e,{emit:l}){const a=e,s=l,t=ye(a.value),o=S(oe);K(()=>t.columnName,()=>{s("update:value",t)}),K(()=>t.comparator,()=>{s("update:value",t)}),K(()=>t.ftv,()=>{s("update:value",t)}),fe(()=>{o.value=oe});const w=C=>{let p=0;if(a.dataTypeMap.hasOwnProperty(a.tableTyp.toString()))for(const L of a.dataTypeMap[a.tableTyp.toString()])C===L.attribute_name&&(p=L.data_type);return je[p]},f=()=>{const C=w(t.columnName);for(const p in C){t.comparator=p;break}s("update:value",t)};return(C,p)=>{const L=c("el-option"),V=c("el-option-group"),A=c("el-select"),O=c("el-input"),v=c("el-date-picker");return i(),h("div",null,[u("div",$e,[r(A,{modelValue:t.columnName,"onUpdate:modelValue":p[0]||(p[0]=m=>t.columnName=m),filterable:"",style:{width:"300px"},placeholder:"请选择",onChange:f},{default:d(()=>[(i(!0),h(Y,null,G(e.options,m=>(i(),y(V,{key:m.label,label:m.label},{default:d(()=>[(i(!0),h(Y,null,G(m.options,g=>(i(),y(L,{key:g.value,label:g.label,value:g.value},{default:d(()=>[u("span",Je,j(g.label),1),u("span",Pe,j(g.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),r(A,{modelValue:t.comparator,"onUpdate:modelValue":p[1]||(p[1]=m=>t.comparator=m),style:{width:"80px"}},{default:d(()=>[(i(!0),h(Y,null,G(w(t.columnName),(m,g,E)=>(i(),y(L,{key:E,label:m,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),B(Ce).includes(t.comparator)?(i(),h(Y,{key:0},[],64)):B(Ve).includes(t.comparator)?(i(),h(Y,{key:1},[r(O,{modelValue:t.ftv[0],"onUpdate:modelValue":p[2]||(p[2]=m=>t.ftv[0]=m),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"]),U(" ~ "),r(O,{modelValue:t.ftv[1],"onUpdate:modelValue":p[3]||(p[3]=m=>t.ftv[1]=m),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"])],64)):B(Me).includes(t.comparator)?(i(),y(O,{key:2,modelValue:t.ftv,"onUpdate:modelValue":p[4]||(p[4]=m=>t.ftv=m),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):B(Ye).includes(t.comparator)?(i(),y(v,{key:3,modelValue:t.ftv,"onUpdate:modelValue":p[5]||(p[5]=m=>t.ftv=m),type:"datetimerange",align:"right","default-time":["00:00:00","23:59:59"],"unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":B(oe)},null,8,["modelValue","picker-options"])):t.comparator=="match"?(i(),y(O,{key:4,modelValue:t.ftv,"onUpdate:modelValue":p[6]||(p[6]=m=>t.ftv=m),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):(i(),y(Re,{key:5,ref:"values",modelValue:t.ftv,"onUpdate:modelValue":p[7]||(p[7]=m=>t.ftv=m),"table-typ":e.tableTyp,style:{width:"300px"},data:t.columnName},null,8,["modelValue","table-typ","data"]))])])}}};const ie=e=>(Ie("data-v-5e3c0ee4"),e=e(),Ae(),e),Fe={class:"xwl_main",style:{"margin-top":"20px"}},He={class:"relation-editor globalFilters_xwl"},qe={class:"relation-relation"},Ke=ie(()=>u("em",{class:"relation-relation-line"},null,-1)),Qe={class:"relation-main"},We={class:"ta-multa-filter-condition"},Xe={key:0,class:"action-row row___xwl"},Ze={class:"action-right"},et={key:1,class:"relation-editor"},tt={class:"relation-relation"},at=ie(()=>u("div",{class:"relation-relation-sub"},"◆",-1)),lt=ie(()=>u("em",{class:"relation-relation-line-sub"},null,-1)),ot=["onClick"],nt={class:"relation-main"},st={class:"relation-row"},it={class:"action-left"},rt={class:"action-right"},dt={style:{padding:"0 12px"}},ut={__name:"index",props:{value:{type:Object,default:()=>({relationLine:"且",relationArr:[],ftv:[]})},fontColor:{type:String,default:"#3d90ff"},tableTyp:{type:Number,default:0},dataTypeMap:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:l}){const a=e,s=l,t=S(!0),o=ye({...a.value}),w=()=>{t.value=!1,he(()=>{t.value=!0})},f=v=>{const m=o.filts[v],g={filterType:"COMPOUND",filts:[],relation:"且"};g.filts.push(m),g.filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),o.filts[v]=g,s("update:value",o)},C=v=>{o.filts[v].filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),s("update:value",o)},p=(v,m)=>{if(o.filts[v].filts.length>2)o.filts[v].filts.splice(m,1);else{const g=[...o.filts[v].filts];g.splice(m,1);const E=g[0];o.filts[v]=E}s("update:value",o)},L=()=>{if(a.options.length==0){s("update:value",o),x({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}if(a.options[0].options.length===0){s("update:value",o),x({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}o.filts.push({columnName:a.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),s("update:value",o)},V=v=>{o.filts.splice(v,1),s("update:value",o),w()},A=()=>{o.relation=o.relation==="或"?"且":"或",s("update:value",o)},O=v=>{o.filts[v].relation=o.filts[v].relation==="或"?"且":"或",s("update:value",o)};return(v,m)=>{const g=c("el-button"),E=c("el-button-group");return i(),h("div",null,[u("div",Fe,[u("div",He,[u("div",qe,[Ke,o.filts.length>1?(i(),h("div",{key:0,class:"relation-relation-value",onClick:A},j(o.relation),1)):I("",!0)]),u("div",Qe,[(i(!0),h(Y,null,G(o.filts,(R,N)=>(i(),h("div",{key:N,class:"relation-row"},[u("div",We,[R.filterType==="SIMPLE"?(i(),h("div",Xe,[t.value?(i(),y(me,{key:0,value:o.filts[N],"onUpdate:value":F=>o.filts[N]=F,options:a.options,"table-typ":a.tableTyp,"data-type-map":a.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"])):I("",!0),u("div",Ze,[r(E,null,{default:d(()=>[r(g,{type:"link",class:"actions_xwl_btn",onClick:()=>f(N),icon:B(ce)},null,8,["onClick","icon"]),r(g,{type:"link",class:"actions_xwl_btn",icon:B(pe),onClick:()=>V(N)},null,8,["icon","onClick"])]),_:2},1024)])])):(i(),h("div",et,[u("div",tt,[at,lt,u("div",{class:"relation-relation-value",onClick:()=>O(N)},j(R.relation),9,ot)]),u("div",nt,[u("div",st,[(i(!0),h(Y,null,G(R.filts,(F,z)=>(i(),h("div",{key:z,class:"action-row row___xwl"},[u("div",it,[(i(),y(me,{key:(N+"_"+z).toString(),value:R.filts[z],"onUpdate:value":H=>R.filts[z]=H,options:a.options,"table-typ":a.tableTyp,"data-type-map":a.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"]))]),u("div",rt,[r(E,null,{default:d(()=>[r(g,{type:"link",class:"actions_xwl_btn",onClick:()=>C(N),icon:B(ce)},null,8,["onClick","icon"]),r(g,{type:"link",class:"actions_xwl_btn",icon:B(pe),onClick:()=>p(N,z)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])])]))])]))),128))])])]),u("div",dt,[u("span",{style:Ue({color:a.fontColor}),class:"footadd___2D4YB",onClick:L},j(v.$t("增加条件")),5)])])}}},ct=W(ut,[["__scopeId","data-v-5e3c0ee4"]]),re="/api/es_crud/";function pt(e){return T.request({url:re+"GetList",method:"post",transformResponse:[l=>we.parse(l)],data:e})}function mt(e){return T.request({url:re+"GetDSL",method:"post",data:e})}function _t(e){return T.request({responseType:"arraybuffer",url:re+"Download",method:"post",data:e})}const ft={name:"Crud",setup(){return{ctx:ve().appContext.config.globalProperties}},components:{JsonEditor:se,FilterWhere:ct},computed:{jsonDataString(){return JSON.stringify(this.jsonData,null,"	")},queryDslString(){return JSON.stringify(this.queryDsl,null,"	")}},props:{indexName:{type:String,default:"test2"},attrMapProp:{type:Array,default:[]},eventAttrOptionsProp:{type:Array,default:[]}},data(){return{ctx:null,showJsonEditor1:!1,showJsonEditor2:!1,properties:{},openAddDialog:!1,tableLoading:!1,tableHeader:[],tableData:[],crudTab:"filter",eventAttrOptions:this.eventAttrOptionsProp,attrMap:this.attrMapProp,whereFilter:{filterType:"COMPOUND",filts:[],relation:"且"},sortList:[],input:{page:1,limit:20},count:0,typName:"",newDoc:{},jsonData:{},tableDataClone:[],drawerShow:!1,queryDslShow:!1,queryDsl:{},downloadLoading:!1}},mounted(){this.indexName!=""&&this.search(1)},methods:{download(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:T.sdk.GetSelectEsConnID()},l=document.createElement("a");this.downloadLoading=!0,_t(e).then(a=>{if(a){const s=new Blob([a],{type:"application/vnd.ms-excel"}),t=URL.createObjectURL(s);l.href=t,l.download=this.indexName+".csv",l.click(),URL.revokeObjectURL(t)}this.downloadLoading=!1}).catch(a=>{this.downloadLoading=!1,console.error(a)})},drawerShowFn(){this.drawerShow=!1,this.$nextTick(()=>{this.drawerShow=!0,this.$nextTick(()=>{this.showJsonEditor1=!0})})},look(e){this.index=e,console.log("this.tableDataClone",this.tableDataClone),this.jsonData=this.tableDataClone[e],this.drawerShowFn()},async updateByID(){console.log("this.jsonData",this.jsonData);const e=this.jsonData,l=e._source,a={};a.es_connect=T.sdk.GetSelectEsConnID(),a.index=e._index,a.type_name=e._type,a.id=e._id,a.json=l;const s=await Le(a);s.code==0?(this.search(1),x({type:"success",message:s.msg})):x({type:"error",message:s.msg})},getEditDoc(e){try{const l=JSON.parse(e);this.jsonData=l}catch{}},getNewDoc(e){try{this.newDoc=JSON.parse(e)}catch{}},async add(){const e=this.newDoc,l={};l.es_connect=T.sdk.GetSelectEsConnID(),l.index=this.indexName,l.type_name=this.typName,l.json=e;const a=await Ne(l);a.code==0?x({type:"success",message:a.msg+"(_id为:"+a.data._id+")",duration:2e4}):x({type:"error",message:a.msg})},drawerHandleClose(e){e()},async deleteByID(e,l){ge.confirm("确定删除ID为【"+e._id+"】的这条文档吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a={};a.es_connect=T.sdk.GetSelectEsConnID(),a.index_name=this.indexName,a.type=this.typName,a.id=e._id;const s=await Te(a);s.code==0?setTimeout(async()=>{await this.search(1),x({type:"success",message:s.msg})},1e3):x({type:"error",message:s.msg})}).catch(a=>{console.error(a)})},async initTableData(e){if(e.hasOwnProperty("hits")&&e.hits.hits.length>0){this.typName=e.hits.hits[0]._type;const l=[];this.tableDataClone=ze(e.hits.hits);for(const a in e.hits.hits){const s=e.hits.hits[a]._source;s._id=e.hits.hits[a]._id,s._score=e.hits.hits[a]._score,s.xwl_index=a,l.push(s)}this.tableData=l;for(const a in this.tableData)for(const s in this.tableData[a])(typeof this.tableData[a][s]=="object"||typeof this.tableData[a][s]=="array")&&(this.tableData[a][s]=JSON.stringify(this.tableData[a][s]))}this.$nextTick(()=>{this.$refs.multipleTable.doLayout()})},async getMapping(){const e={};e.es_connect=T.sdk.GetSelectEsConnID(),e.index_name=this.indexName;const{data:l,code:a,msg:s}=await _e(e);if(a==0){if(l.ver==6){const t=Object.keys(l.list[e.index_name].mappings);for(const f in t)if(t[f]=="_default_"){t.splice(f,1);break}const o=Object.keys(l.list[e.index_name].mappings[t[0]].properties);this.properties=l.list[e.index_name].mappings[t[0]].properties;const w=[];w.push("_id");for(const f in o)o[f]!="_id"&&w.push(o[f]);this.tableHeader=w}else if(l.ver==7||l.ver==8){if(JSON.stringify(l.list[e.index_name].mappings)=="{}"){x({type:"error",message:"该索引没有设置映射结构"});return}const t=Object.keys(l.list[e.index_name].mappings.properties);this.properties=l.list[e.index_name].mappings.properties;const o=[];o.push("_id");for(const w in t)t[w]!="_id"&&o.push(t[w]);this.tableHeader=o}}else x({type:"error",message:s})},pushSort(){this.sortList.push({col:"",sortRule:"desc"})},deleteSort(e){this.sortList.splice(e,1)},handleSizeChange(e){this.input.limit=e,this.search(1)},async getdsl(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:T.sdk.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},l=await mt(e);if(l.code!=0){x({type:"error",message:l.msg});return}this.queryDsl=l.data.list,this.queryDslShow=!0,this.$nextTick(()=>{this.showJsonEditor2=!0})},async search(e){this.tableLoading=!0,e?this.input.page=e:this.input.page=1;const l={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:T.sdk.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},a=await pt(l);if(a.code!=0){x({type:"error",message:a.msg}),this.tableData=[],this.tableLoading=!1;return}this.count=a.data.count,await this.getMapping(),this.count>0?await this.initTableData(a.data.list):this.tableData=[],this.tableLoading=!1}}},yt={class:"app-container",style:{height:"95%"}},ht={class:"search-container"},vt={class:"search-container"},gt={class:"relation-row"},bt={class:"action-left"},wt={style:{float:"left"}},kt={style:{float:"right",color:"#8492a6","font-size":"13px"}},Dt={style:{padding:"0 12px"}},xt={class:"search-container"},St={key:1,style:{padding:"40px",width:"300px",height:"800px","text-align":"center",margin:"0px auto",position:"relative",top:"30%"}};function Ct(e,l,a,s,t,o){const w=c("filter-where"),f=c("el-tab-pane"),C=c("el-option"),p=c("el-option-group"),L=c("el-select"),V=c("el-button"),A=c("el-tabs"),O=c("el-form-item"),v=c("el-form"),m=c("el-table-column"),g=c("el-button-group"),E=c("el-table"),R=c("el-pagination"),N=c("el-card"),F=c("el-tag"),z=c("json-editor"),H=c("el-drawer"),X=c("el-empty"),k=be("loading");return i(),h("div",null,[u("div",yt,[a.indexName!=""?(i(),h(Y,{key:0},[u("div",ht,[r(A,{modelValue:t.crudTab,"onUpdate:modelValue":l[2]||(l[2]=n=>t.crudTab=n)},{default:d(()=>[r(f,{lazy:!0,label:e.$t("筛选"),name:"filter"},{default:d(()=>[r(w,{value:t.whereFilter,"onUpdate:value":l[0]||(l[0]=n=>t.whereFilter=n),"table-typ":"2","data-type-map":t.attrMap,options:t.eventAttrOptions},null,8,["value","data-type-map","options"])]),_:1},8,["label"]),r(f,{lazy:"true",label:e.$t("排序"),name:"sort"},{default:d(()=>[u("div",vt,[u("div",gt,[(i(!0),h(Y,null,G(t.sortList,(n,_)=>(i(),h("div",{key:_,class:"action-row row___xwl"},[u("div",bt,[r(L,{modelValue:t.sortList[_].col,"onUpdate:modelValue":b=>t.sortList[_].col=b,filterable:"",style:{width:"300px","margin-left":"30px"},placeholder:e.$t("请选择")},{default:d(()=>[(i(!0),h(Y,null,G(a.eventAttrOptionsProp,b=>(i(),y(p,{key:b.label,label:b.label},{default:d(()=>[(i(!0),h(Y,null,G(b.options,M=>(i(),y(C,{key:M.value,label:M.label,value:M.value},{default:d(()=>[u("span",wt,j(M.label),1),u("span",kt,j(M.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),r(L,{modelValue:t.sortList[_].sortRule,"onUpdate:modelValue":b=>t.sortList[_].sortRule=b,style:{width:"100px","margin-left":"30px"},placeholder:e.$t("请选择排序规则"),filterable:""},{default:d(()=>[r(C,{label:e.$t("正序排"),value:"asc"},null,8,["label"]),r(C,{label:e.$t("倒序排"),value:"desc"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),r(V,{style:{"margin-left":"30px"},class:"actions_xwl_btn",onClick:b=>o.deleteSort(_)},{default:d(()=>[U("删除")]),_:2},1032,["onClick"])])]))),128))])]),u("div",Dt,[u("span",{style:{color:"#3d90ff"},class:"footadd___2D4YB",onClick:l[1]||(l[1]=(...n)=>o.pushSort&&o.pushSort(...n))},j(e.$t("增加排序")),1)])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),r(N,{class:"box-card"},{default:d(()=>[u("div",xt,[r(v,null,{default:d(()=>[r(O,null,{default:d(()=>[r(V,{type:"warning",onClick:l[3]||(l[3]=n=>o.getdsl(1))},{default:d(()=>[U("查看查询语句 ")]),_:1}),r(V,{type:"success",onClick:l[4]||(l[4]=n=>o.search(1))},{default:d(()=>[U("查询 ")]),_:1}),r(V,{disabled:t.downloadLoading,loading:t.downloadLoading,type:"primary",onClick:l[5]||(l[5]=n=>o.download())},{default:d(()=>[U("下载 ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),ne((i(),y(E,{height:"400",data:t.tableData,"use-virtual":"",ref:"multipleTable","row-height":30,"show-overflow-tooltip":""},{default:d(()=>[r(m,{label:"ID",align:"center",fixed:"","min-width":"100",prop:"_id"}),(i(!0),h(Y,null,G(t.tableHeader,(n,_)=>(i(),h(Y,null,[n!="xwl_index"&&n!="_id"?(i(),y(m,{key:0,prop:n,sortable:!0,align:"center",label:n},null,8,["prop","label"])):I("",!0)],64))),256)),r(m,{align:"center",label:e.$t("操作"),fixed:"right",width:"200"},{default:d(n=>[r(g,null,{default:d(()=>[r(V,{type:"primary",onClick:_=>o.look(n.$index)},{default:d(()=>[U(" 编辑 ")]),_:2},1032,["onClick"]),r(V,{type:"danger",onClick:_=>o.deleteByID(n.row,n.$index)},{default:d(()=>[U(j(e.$t("删除")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[k,t.tableLoading]]),r(R,{"current-page":t.input.page,"page-sizes":[10,20,30,50,100,150,200],"page-size":t.input.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.count,onSizeChange:o.handleSizeChange,onCurrentChange:o.search},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),r(H,{ref:"drawer",title:"详细数据","before-close":o.drawerHandleClose,modelValue:t.drawerShow,"onUpdate:modelValue":l[7]||(l[7]=n=>t.drawerShow=n),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:d(()=>[r(F,null,{default:d(()=>[U("操作")]),_:1}),r(V,{type:"primary",onClick:o.updateByID},{default:d(()=>[U("修改 ")]),_:1},8,["onClick"]),t.showJsonEditor1?(i(),y(z,{key:0,value:o.jsonDataString,"onUpdate:value":l[6]||(l[6]=n=>o.jsonDataString=n),height:"900",class:"res-body",styles:"width: 100%",title:"详细数据",onGetValue:o.getEditDoc},null,8,["value","onGetValue"])):I("",!0)]),_:1},8,["before-close","modelValue"]),r(H,{ref:"drawer",title:"查询DSL","before-close":o.drawerHandleClose,modelValue:t.queryDslShow,"onUpdate:modelValue":l[9]||(l[9]=n=>t.queryDslShow=n),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:d(()=>[t.showJsonEditor2?(i(),y(z,{key:0,value:o.queryDslString,"onUpdate:value":l[8]||(l[8]=n=>o.queryDslString=n),height:"900",class:"res-body",styles:"width: 100%",title:"DSL",read:!0},null,8,["value"])):I("",!0)]),_:1},8,["before-close","modelValue"])],64)):(i(),h("div",St,[r(X,{content:"请先点击左侧索引名称"})]))])])}const Vt=W(ft,[["render",Ct],["__scopeId","data-v-afc2498a"]]);const Mt={class:"navicat-container"},Yt={class:"content-wrapper"},jt={class:"left-panel"},Lt={class:"search-container"},Nt={class:"el-dropdown-link"},Tt={slot:"title"},Ot={class:"right-panel"},Ut={style:{height:"100%",width:"100%",display:"inline-block","vertical-align":"top"}},It={__name:"index",setup(e){ve().appContext.config.globalProperties;const l=S([]),a=S({}),s=S(!1),t=S(!0),o=S("settings"),w=S(!1),f=S([]),C=S(""),p=S(""),L=S({}),V=S([]),A=S(!1),O=S([]),v=le(()=>C.value===""?f.value:De(f.value,C.value)),m=le(()=>JSON.stringify(L.value,null,"	")),g=le(()=>JSON.stringify(a.value,null,"	")),E=()=>{t.value=!1,he(()=>{t.value=!0})},R=async k=>{p.value=k;const n={es_connect:T.sdk.GetSelectEsConnID(),index_name:p.value};s.value=!0,console.log("123");try{const _=await _e(n);if(_.code!==0){s.value=!1,x.error(_.msg);return}const b=await xe(n);if(b.code!==0){s.value=!1,x.error(b.msg);return}a.value=_.data.list;const M=[{label:"筛选字段",options:[{value:"_id",label:"_id"}]}],q={2:[{attribute_name:"_id",show_name:"_id",data_type:3}]};let J={};switch(_.data.ver){case 6:J=a.value[p.value].mappings[Object.keys(a.value[p.value].mappings)[0]].properties;break;case 7:case 8:J=a.value[p.value].mappings.properties;break}const Z=1,ee=2,te=3,Q=5;for(const $ in J)if(J[$].type){M[0].options.push({value:$,label:$});const P={attribute_name:$,show_name:$};switch(J[$].type){case"text":P.data_type=Q;break;case"keyword":P.data_type=te;break;case"byte":case"short":case"integer":case"long":P.data_type=Z;break;case"float":case"half_float":case"scaled_float":case"double":P.data_type=ee;break}q[2].push(P)}O.value=q,V.value=M,L.value=b.data,s.value=!1,E()}catch(_){s.value=!1,x.error("An error occurred while fetching data.",_)}},N=k=>{const n=f.value.findIndex(_=>_.k.toString()===k.toString());n!==-1&&f.value.splice(n,1)},F=async(k,n)=>{try{await ge.confirm("删除该索引不可恢复，确认删除吗？",$t("警告"),{confirmButtonText:$t("确定"),cancelButtonText:$t("取消"),type:"warning"})}catch{return}const _=await Se({es_connect:T.sdk.GetSelectEsConnID(),index_name:n});_.code!==0?x({type:"error",message:_.msg}):(N(k),x({type:"success",message:_.msg}))};Ee(async()=>{z()});const z=async()=>{const k={cat:"CatIndices",es_connect:T.sdk.GetSelectEsConnID()};f.value=[],w.value=!0,l.value=[];const n=await ke(k);if(n.code!=0){x({type:"error",message:n.msg}),w.value=!1;return}for(const _ in n.data){const b=n.data[_],M={health:b.health,index:b.index,k:_,storeSize:b["store.size"],docsCount:b["docs.count"]};f.value.push(M),l.value.push({value:b.index,data:b.index})}w.value=!1},H=(k,n)=>{const _=k?l.value.filter(X(k)):l.value;n(_)},X=k=>n=>n.value.toLowerCase().includes(k.toLowerCase());return(k,n)=>{const _=c("el-autocomplete"),b=c("Grid"),M=c("el-icon"),q=c("el-dropdown-item"),J=c("el-dropdown-menu"),Z=c("el-dropdown"),ee=c("el-menu-item"),te=c("el-menu"),Q=c("el-tab-pane"),$=c("el-tabs"),P=c("el-drawer"),de=be("loading");return i(),h("div",Mt,[u("div",Yt,[r(B(Oe),{class:"page-split",distribute:.2,lineThickness:3,isVertical:!0},{first:d(()=>[u("div",jt,[u("div",Lt,[r(_,{modelValue:C.value,"onUpdate:modelValue":n[0]||(n[0]=D=>C.value=D),class:"search-input",clearable:"","fetch-suggestions":H,placeholder:k.$t("请输入索引名")},{default:d(({item:D})=>[u("span",null,j(D.value),1)]),_:1},8,["modelValue","placeholder"]),ne((i(),y(te,{class:"index-menu"},{default:d(()=>[(i(!0),h(Y,null,G(v.value,(D,ae)=>(i(),y(ee,{index:ae.toString(),onClick:ue=>R(D.index),class:"menu-item"},{default:d(()=>[r(Z,null,{dropdown:d(()=>[r(J,null,{default:d(()=>[r(q,{onClick:ue=>F(v.value[ae].k,v.value[ae].index)},{default:d(()=>[U(j(k.$t("删除")),1)]),_:2},1032,["onClick"]),r(q,{onClick:n[1]||(n[1]=ue=>A.value=!0)},{default:d(()=>[U(j(k.$t("结构")),1)]),_:1})]),_:2},1024)]),default:d(()=>[u("span",Nt,[D.health=="red"?(i(),y(M,{key:0,style:{color:"red"}},{default:d(()=>[r(b)]),_:1})):I("",!0),D.health=="green"?(i(),y(M,{key:1,style:{color:"#13ce66"}},{default:d(()=>[r(b)]),_:1})):I("",!0),D.health=="yellow"?(i(),y(M,{key:2,style:{color:"#ffba00"}},{default:d(()=>[r(b)]),_:1})):I("",!0)])]),_:2},1024),u("span",Tt,j(D.index)+"【"+j(D.storeSize)+"】",1)]),_:2},1032,["index","onClick"]))),256))]),_:1})),[[de,w.value]])])])]),second:d(()=>[u("div",Ot,[t.value?(i(),y(Vt,{key:0,"attr-map-prop":O.value,"event-attr-options-prop":V.value,"index-name":p.value},null,8,["attr-map-prop","event-attr-options-prop","index-name"])):I("",!0)]),r(P,{ref:"drawer",title:k.$t("索引结构"),modelValue:A.value,"onUpdate:modelValue":n[5]||(n[5]=D=>A.value=D),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:d(()=>[u("div",Ut,[ne((i(),y($,{modelValue:o.value,"onUpdate:modelValue":n[4]||(n[4]=D=>o.value=D),type:"border-card"},{default:d(()=>[r(Q,{lazy:!0,label:k.$t("索引设置"),name:"settings"},{default:d(()=>[t.value?(i(),y(se,{key:0,value:m.value,"onUpdate:value":n[2]||(n[2]=D=>m.value=D),height:"720",styles:"width: 100%",read:!0,title:p.value},null,8,["value","title"])):I("",!0)]),_:1},8,["label"]),r(Q,{lazy:!0,label:k.$t("映射结构"),name:"mappings"},{default:d(()=>[t.value?(i(),y(se,{key:0,value:g.value,"onUpdate:value":n[3]||(n[3]=D=>g.value=D),height:"720",styles:"width: 100%",read:!0,title:p.value},null,8,["value","title"])):I("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])),[[de,s.value]])])]),_:1},8,["title","modelValue"])]),_:1})])])}}},Ft=W(It,[["__scopeId","data-v-1bb6f814"]]);export{Ft as default};
