import{j as we,C as ke,f as De}from"./es-bf414a5e.js";import{G as xe,D as Se}from"./es-index-a89245ce.js";import{n as Ce,r as Ve,i as Me,c as Ye,d as Te,L as he}from"./es-map-f3605a71.js";import{D as me,U as Ae,I as Ie,K as je}from"./style-1fc380ff.js";import{f as S,g as Z,O as W,h as re,r as d,o as u,b as w,w as c,c as f,F as Y,v as G,T as ve,m as p,a as i,t as O,u as z,j as L,x as Le,E as b,y as $,U as _e,z as fe,s as Ne,G as Oe,H as Ue,C as ge,k as N,P as ne,A as be,B as se,i as Ee}from"./index-fa15ecb5.js";import{J as ie}from"./index-5e251ebd.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{c as Re}from"./index-0aae8c1b.js";const oe={shortcuts:[{text:"今天",value:()=>[dayjs().format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"昨天",value:()=>[dayjs().subtract(-1,"day").format("YYYY-MM-DD 00:00:00"),dayjs().subtract(-1,"day").format("YYYY-MM-DD 23:59:59")]},{text:"一周",value:()=>[dayjs().subtract(-7,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"两周",value:()=>[dayjs().subtract(-14,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一月",value:()=>[dayjs().subtract(-30,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"三个月",value:()=>[dayjs().subtract(-90,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"半年",value:()=>[dayjs().subtract(-180,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]},{text:"一年",value:()=>[dayjs().subtract(-360,"day").format("YYYY-MM-DD 00:00:00"),dayjs().format("YYYY-MM-DD 23:59:59")]}]},Be={name:"Values",props:{data:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""}},setup(e,{emit:l}){const o=S([]),s=S(Array.isArray(e.value)?[...e.value]:[]),t=Z(()=>[...new Set([...o.value,...Array.isArray(s.value)?s.value:[]])]),n=()=>{s.value=[],l("update:value",s.value)},h=()=>{l("update:value",s.value)},_=v=>{},x=v=>{if(!v||!Array.isArray(v))return;Array.isArray(s.value)||(s.value=[]);const U=[];v.forEach(M=>{const E=M.trim();E&&!s.value.includes(E)&&U.push(E)}),s.value=[...s.value,...U],o.value=[...new Set([...o.value,...U])],l("update:value",s.value)};return W(()=>e.data,v=>{}),W(s,v=>{l("update:value",v)}),re(()=>{_(e.data),Array.isArray(s.value)||(s.value=[])}),{options:o,selectVal:s,selectOptions:t,cleanValues:n,changeValue:h,batchImportValues:x}}};function ze(e,l,o,s,t,n){const h=d("el-option"),_=d("el-select");return u(),w(_,{"collapse-tags-tooltip":"",modelValue:s.selectVal,"onUpdate:modelValue":l[0]||(l[0]=x=>s.selectVal=x),filterable:"",placeholder:"请输入筛选值",style:{width:"240px"},multiple:"","default-first-option":"","allow-create":"","collapse-tags":"","reserve-keyword":!1,clearable:""},{default:c(()=>[(u(!0),f(Y,null,G(s.selectOptions,x=>(u(),w(h,{key:x,label:x,value:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}const $e=Q(Be,[["render",ze]]);const Ge={class:"ta-filter-condition"},Je={style:{float:"left"}},Pe={style:{float:"right",color:"#8492a6","font-size":"13px"}},He={class:"dialog-footer"},Fe={__name:"ActionRow",props:{value:{type:Object,default:()=>({})},datas:{type:Object,default:()=>({})},options:{type:Array,default:()=>[]},dataTypeMap:{type:Array,default:()=>[]},tableTyp:{type:Number,default:0}},emits:["update:value"],setup(e,{emit:l}){const o=e,s=l,t=ve(o.value),n=S(null),h=S(!1),_=S(""),x=S(oe);W(()=>t.columnName,()=>{s("update:value",t)}),W(()=>t.comparator,()=>{s("update:value",t)}),W(()=>t.ftv,()=>{s("update:value",t)}),re(()=>{x.value=oe});const v=C=>{let r=0;if(o.dataTypeMap.hasOwnProperty(o.tableTyp.toString()))for(const g of o.dataTypeMap[o.tableTyp.toString()])C===g.attribute_name&&(r=g.data_type);return Te[r]},U=()=>{const C=v(t.columnName);for(const r in C){t.comparator=r;break}s("update:value",t)},M=()=>{h.value=!0,_.value=""},E=()=>{if(!_.value.trim()){b.warning("导入内容不能为空");return}const C=_.value.split(`
`).filter(r=>r.trim()!=="");if(C.length===0){b.warning("没有有效的导入内容");return}if(n.value&&typeof n.value.batchImportValues=="function"){if(n.value.batchImportValues(C),Array.isArray(t.ftv)){const r=new Set(t.ftv);C.forEach(g=>{const D=g.trim();D&&r.add(D)}),t.ftv=Array.from(r)}else t.ftv=C.filter(r=>r.trim());s("update:value",t),b.success(`成功导入${C.length}个值`)}else Array.isArray(t.ftv)||(t.ftv=[]),C.forEach(r=>{const g=r.trim();g&&!t.ftv.includes(g)&&t.ftv.push(g)}),s("update:value",t),b.success(`成功导入${C.length}个值`);h.value=!1};return(C,r)=>{const g=d("el-option"),D=d("el-option-group"),R=d("el-select"),T=d("el-input"),A=d("el-date-picker"),P=d("el-icon"),I=d("el-button"),H=d("el-form-item"),q=d("el-form"),k=d("el-dialog");return u(),f("div",null,[p("div",Ge,[i(R,{modelValue:t.columnName,"onUpdate:modelValue":r[0]||(r[0]=a=>t.columnName=a),filterable:"",style:{width:"300px"},placeholder:"请选择",onChange:U},{default:c(()=>[(u(!0),f(Y,null,G(e.options,a=>(u(),w(D,{key:a.label,label:a.label},{default:c(()=>[(u(!0),f(Y,null,G(a.options,m=>(u(),w(g,{key:m.value,label:m.label,value:m.value},{default:c(()=>[p("span",Je,O(m.label),1),p("span",Pe,O(m.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),i(R,{modelValue:t.comparator,"onUpdate:modelValue":r[1]||(r[1]=a=>t.comparator=a),style:{width:"80px"}},{default:c(()=>[(u(!0),f(Y,null,G(v(t.columnName),(a,m,y)=>(u(),w(g,{key:y,label:a,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),z(Ce).includes(t.comparator)?(u(),f(Y,{key:0},[],64)):z(Ve).includes(t.comparator)?(u(),f(Y,{key:1},[i(T,{modelValue:t.ftv[0],"onUpdate:modelValue":r[2]||(r[2]=a=>t.ftv[0]=a),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"]),L(" ~ "),i(T,{modelValue:t.ftv[1],"onUpdate:modelValue":r[3]||(r[3]=a=>t.ftv[1]=a),clearable:"",type:"number",style:{width:"150px"}},null,8,["modelValue"])],64)):z(Me).includes(t.comparator)?(u(),w(T,{key:2,modelValue:t.ftv,"onUpdate:modelValue":r[4]||(r[4]=a=>t.ftv=a),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):z(Ye).includes(t.comparator)?(u(),w(A,{key:3,modelValue:t.ftv,"onUpdate:modelValue":r[5]||(r[5]=a=>t.ftv=a),type:"datetimerange",align:"right","default-time":["00:00:00","23:59:59"],"unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":z(oe)},null,8,["modelValue","picker-options"])):t.comparator=="match"?(u(),w(T,{key:4,modelValue:t.ftv,"onUpdate:modelValue":r[6]||(r[6]=a=>t.ftv=a),clearable:"",style:{width:"300px"}},null,8,["modelValue"])):(u(),f(Y,{key:5},[i($e,{ref_key:"selectValuesRef",ref:n,modelValue:t.ftv,"onUpdate:modelValue":r[7]||(r[7]=a=>t.ftv=a),"table-typ":e.tableTyp,style:{width:"300px"},data:t.columnName},null,8,["modelValue","table-typ","data"]),i(I,{class:"import-btn",type:"primary",size:"small",circle:"",onClick:M},{default:c(()=>[i(P,null,{default:c(()=>[i(z(Le))]),_:1})]),_:1})],64))]),i(k,{modelValue:h.value,"onUpdate:modelValue":r[10]||(r[10]=a=>h.value=a),title:"批量导入",width:"80%"},{footer:c(()=>[p("span",He,[i(I,{onClick:r[9]||(r[9]=a=>h.value=!1)},{default:c(()=>[L("取消")]),_:1}),i(I,{type:"primary",onClick:E},{default:c(()=>[L("完成")]),_:1})])]),default:c(()=>[i(q,null,{default:c(()=>[i(H,{label:""},{default:c(()=>[i(T,{modelValue:_.value,"onUpdate:modelValue":r[8]||(r[8]=a=>_.value=a),type:"textarea",rows:10,placeholder:"请输入内容，每行一个值"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ye=Q(Fe,[["__scopeId","data-v-9fe374fc"]]);const ce=e=>(Oe("data-v-5e3c0ee4"),e=e(),Ue(),e),qe={class:"xwl_main",style:{"margin-top":"20px"}},Ke={class:"relation-editor globalFilters_xwl"},We={class:"relation-relation"},Qe=ce(()=>p("em",{class:"relation-relation-line"},null,-1)),Xe={class:"relation-main"},Ze={class:"ta-multa-filter-condition"},et={key:0,class:"action-row row___xwl"},tt={class:"action-right"},at={key:1,class:"relation-editor"},lt={class:"relation-relation"},ot=ce(()=>p("div",{class:"relation-relation-sub"},"◆",-1)),nt=ce(()=>p("em",{class:"relation-relation-line-sub"},null,-1)),st=["onClick"],it={class:"relation-main"},rt={class:"relation-row"},ct={class:"action-left"},ut={class:"action-right"},dt={style:{padding:"0 12px"}},pt={__name:"index",props:{value:{type:Object,default:()=>({relationLine:"且",relationArr:[],ftv:[]})},fontColor:{type:String,default:"#3d90ff"},tableTyp:{type:Number,default:0},dataTypeMap:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:l}){const o=e,s=l,t=S(!0),n=ve({...o.value}),h=()=>{t.value=!1,ge(()=>{t.value=!0})},_=r=>{const g=n.filts[r],D={filterType:"COMPOUND",filts:[],relation:"且"};D.filts.push(g),D.filts.push({columnName:o.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),n.filts[r]=D,s("update:value",n)},x=r=>{n.filts[r].filts.push({columnName:o.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),s("update:value",n)},v=(r,g)=>{if(n.filts[r].filts.length>2)n.filts[r].filts.splice(g,1);else{const D=[...n.filts[r].filts];D.splice(g,1);const R=D[0];n.filts[r]=R}s("update:value",n)},U=()=>{if(o.options.length==0){s("update:value",n),b({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}if(o.options[0].options.length===0){s("update:value",n),b({offset:60,message:"该索引没有字段，无法筛选",type:"error"});return}n.filts.push({columnName:o.options[0].options[0].value,comparator:"=",filterType:"SIMPLE",ftv:""}),s("update:value",n)},M=r=>{n.filts.splice(r,1),s("update:value",n),h()},E=()=>{n.relation=n.relation==="或"?"且":"或",s("update:value",n)},C=r=>{n.filts[r].relation=n.filts[r].relation==="或"?"且":"或",s("update:value",n)};return(r,g)=>{const D=d("el-button"),R=d("el-button-group");return u(),f("div",null,[p("div",qe,[p("div",Ke,[p("div",We,[Qe,n.filts.length>1?(u(),f("div",{key:0,class:"relation-relation-value",onClick:E},O(n.relation),1)):$("",!0)]),p("div",Xe,[(u(!0),f(Y,null,G(n.filts,(T,A)=>(u(),f("div",{key:A,class:"relation-row"},[p("div",Ze,[T.filterType==="SIMPLE"?(u(),f("div",et,[t.value?(u(),w(ye,{key:0,value:n.filts[A],"onUpdate:value":P=>n.filts[A]=P,options:o.options,"table-typ":o.tableTyp,"data-type-map":o.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"])):$("",!0),p("div",tt,[i(R,null,{default:c(()=>[i(D,{type:"link",class:"actions_xwl_btn",onClick:()=>_(A),icon:z(_e)},null,8,["onClick","icon"]),i(D,{type:"link",class:"actions_xwl_btn",icon:z(fe),onClick:()=>M(A)},null,8,["icon","onClick"])]),_:2},1024)])])):(u(),f("div",at,[p("div",lt,[ot,nt,p("div",{class:"relation-relation-value",onClick:()=>C(A)},O(T.relation),9,st)]),p("div",it,[p("div",rt,[(u(!0),f(Y,null,G(T.filts,(P,I)=>(u(),f("div",{key:I,class:"action-row row___xwl"},[p("div",ct,[(u(),w(ye,{key:(A+"_"+I).toString(),value:T.filts[I],"onUpdate:value":H=>T.filts[I]=H,options:o.options,"table-typ":o.tableTyp,"data-type-map":o.dataTypeMap,class:"action-left"},null,8,["value","onUpdate:value","options","table-typ","data-type-map"]))]),p("div",ut,[i(R,null,{default:c(()=>[i(D,{type:"link",class:"actions_xwl_btn",onClick:()=>x(A),icon:z(_e)},null,8,["onClick","icon"]),i(D,{type:"link",class:"actions_xwl_btn",icon:z(fe),onClick:()=>v(A,I)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])])]))])]))),128))])])]),p("div",dt,[p("span",{style:Ne({color:o.fontColor}),class:"footadd___2D4YB",onClick:U},O(r.$t("增加条件")),5)])])}}},mt=Q(pt,[["__scopeId","data-v-5e3c0ee4"]]),ue="/api/es_crud/";function _t(e){return N.request({url:ue+"GetList",method:"post",transformResponse:[l=>we.parse(l)],data:e})}function ft(e){return N.request({url:ue+"GetDSL",method:"post",data:e})}function yt(e){return N.request({responseType:"arraybuffer",url:ue+"Download",method:"post",data:e})}const ht={name:"Crud",setup(){},components:{JsonEditor:ie,FilterWhere:mt},computed:{jsonDataString(){return JSON.stringify(this.jsonData,null,"	")},queryDslString(){return JSON.stringify(this.queryDsl,null,"	")},selectedIds(){return Array.from(this.selectedMap.keys())}},props:{indexName:{type:String,default:"test2"},attrMapProp:{type:Array,default:[]},eventAttrOptionsProp:{type:Array,default:[]}},data(){return{ctx:null,showJsonEditor1:!1,showJsonEditor2:!1,properties:{},openAddDialog:!1,tableLoading:!1,tableHeader:[],tableData:[],crudTab:"filter",eventAttrOptions:this.eventAttrOptionsProp,attrMap:this.attrMapProp,whereFilter:{filterType:"COMPOUND",filts:[],relation:"且"},sortList:[],input:{page:1,limit:20},count:0,typName:"",newDoc:{},jsonData:{},tableDataClone:[],drawerShow:!1,queryDslShow:!1,queryDsl:{},downloadLoading:!1,multipleSelection:[],selectedMap:new Map}},activated(){console.log("crud activated")},mounted(){console.log("crud mounted"),this.indexName!=""&&this.search(1)},methods:{handleSelectionChange(e){e.forEach(l=>{this.selectedMap.set(l._id,l)})},async batchDelete(){if(this.selectedIds.length===0){b({type:"warning",message:"请至少选择一条记录"});return}ne.confirm("确定批量删除吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e={};e.es_connect=N.sdk.GetSelectEsConnID(),e.index_name=this.indexName,e.type=this.typName,e.ids=this.selectedIds;const l=await me(e);l.code==0?(e.ids.forEach(o=>this.selectedMap.delete(o)),setTimeout(async()=>{await this.search(1),b({type:"success",message:l.msg})},1e3)):b({type:"error",message:l.msg})}).catch(e=>{console.error(e)})},download(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:N.sdk.GetSelectEsConnID()},l=document.createElement("a");this.downloadLoading=!0,yt(e).then(o=>{if(o){const s=new Blob([o],{type:"application/vnd.ms-excel"}),t=URL.createObjectURL(s);l.href=t,l.download=this.indexName+".csv",l.click(),URL.revokeObjectURL(t)}this.downloadLoading=!1}).catch(o=>{this.downloadLoading=!1,console.error(o)})},drawerShowFn(){this.drawerShow=!1,this.$nextTick(()=>{this.drawerShow=!0,this.$nextTick(()=>{this.showJsonEditor1=!0})})},look(e){this.index=e,console.log("this.tableDataClone",this.tableDataClone),this.jsonData=this.tableDataClone[e],this.drawerShowFn()},async updateByID(){console.log("this.jsonData",this.jsonData);const e=this.jsonData,l=e._source,o={};o.es_connect=N.sdk.GetSelectEsConnID(),o.index=e._index,o.type_name=e._type,o.id=e._id,o.json=l;const s=await Ae(o);s.code==0?(this.search(1),b({type:"success",message:s.msg})):b({type:"error",message:s.msg})},getEditDoc(e){try{const l=JSON.parse(e);this.jsonData=l}catch{}},getNewDoc(e){try{this.newDoc=JSON.parse(e)}catch{}},async add(){const e=this.newDoc,l={};l.es_connect=N.sdk.GetSelectEsConnID(),l.index=this.indexName,l.type_name=this.typName,l.json=e;const o=await Ie(l);o.code==0?b({type:"success",message:o.msg+"(_id为:"+o.data._id+")",duration:2e4}):b({type:"error",message:o.msg})},drawerHandleClose(e){e()},async deleteByID(e,l){ne.confirm("确定删除ID为【"+e._id+"】的这条文档吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const o={};o.es_connect=N.sdk.GetSelectEsConnID(),o.index_name=this.indexName,o.type=this.typName,o.id=e._id;const s=await me(o);s.code==0?setTimeout(async()=>{await this.search(1),b({type:"success",message:s.msg})},1e3):b({type:"error",message:s.msg})}).catch(o=>{console.error(o)})},async initTableData(e){if(e.hasOwnProperty("hits")&&e.hits.hits.length>0){this.typName=e.hits.hits[0]._type;const l=[];this.tableDataClone=Re(e.hits.hits);for(const o in e.hits.hits){const s=e.hits.hits[o]._source;s._id=e.hits.hits[o]._id,s._score=e.hits.hits[o]._score,s.xwl_index=o,l.push(s)}this.tableData=l;for(const o in this.tableData)for(const s in this.tableData[o])(typeof this.tableData[o][s]=="object"||typeof this.tableData[o][s]=="array")&&(this.tableData[o][s]=JSON.stringify(this.tableData[o][s]))}this.$nextTick(()=>{this.setTableSelection(),this.$refs.multipleTable.doLayout()})},async getMapping(){const e={};e.es_connect=N.sdk.GetSelectEsConnID(),e.index_name=this.indexName;const{data:l,code:o,msg:s}=await he(e);if(o==0){if(l.ver==6){const t=Object.keys(l.list[e.index_name].mappings);for(const _ in t)if(t[_]=="_default_"){t.splice(_,1);break}const n=Object.keys(l.list[e.index_name].mappings[t[0]].properties);this.properties=l.list[e.index_name].mappings[t[0]].properties;const h=[];h.push("_id");for(const _ in n)n[_]!="_id"&&h.push(n[_]);this.tableHeader=h}else if(l.ver==7||l.ver==8){if(JSON.stringify(l.list[e.index_name].mappings)=="{}"){b({type:"error",message:"该索引没有设置映射结构"});return}const t=Object.keys(l.list[e.index_name].mappings.properties);this.properties=l.list[e.index_name].mappings.properties;const n=[];n.push("_id");for(const h in t)t[h]!="_id"&&n.push(t[h]);this.tableHeader=n}}else b({type:"error",message:s})},pushSort(){this.sortList.push({col:"",sortRule:"desc"})},deleteSort(e){this.sortList.splice(e,1)},handleSizeChange(e){this.input.limit=e,this.search(1)},async getdsl(){const e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:N.sdk.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},l=await ft(e);if(l.code!=0){b({type:"error",message:l.msg});return}this.queryDsl=l.data.list,this.queryDslShow=!0,this.$nextTick(()=>{this.showJsonEditor2=!0})},async search(e){this.tableLoading=!0,e?this.input.page=e:this.input.page=1;const l={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:N.sdk.GetSelectEsConnID(),page:this.input.page,limit:this.input.limit},o=await _t(l);if(o.code!=0){b({type:"error",message:o.msg}),this.tableData=[],this.tableLoading=!1;return}this.count=o.data.count,await this.getMapping(),this.count>0?await this.initTableData(o.data.list):this.tableData=[],this.tableLoading=!1},setTableSelection(){this.selectedIds.length>0&&this.tableData.forEach(e=>{this.selectedIds.includes(e._id)&&this.$refs.multipleTable.toggleRowSelection(e,!0)})}}},vt={class:"app-container",style:{height:"95%"}},gt={class:"search-container"},bt={class:"search-container"},wt={class:"relation-row"},kt={class:"action-left"},Dt={style:{float:"left"}},xt={style:{float:"right",color:"#8492a6","font-size":"13px"}},St={style:{padding:"0 12px"}},Ct={class:"search-container"},Vt={key:1,style:{padding:"40px",width:"300px",height:"800px","text-align":"center",margin:"0px auto",position:"relative",top:"30%"}};function Mt(e,l,o,s,t,n){const h=d("filter-where"),_=d("el-tab-pane"),x=d("el-option"),v=d("el-option-group"),U=d("el-select"),M=d("el-button"),E=d("el-tabs"),C=d("el-form-item"),r=d("el-form"),g=d("el-table-column"),D=d("el-button-group"),R=d("el-table"),T=d("el-pagination"),A=d("el-card"),P=d("el-tag"),I=d("json-editor"),H=d("el-drawer"),q=d("el-empty"),k=be("loading");return u(),f("div",null,[p("div",vt,[o.indexName!=""?(u(),f(Y,{key:0},[p("div",gt,[i(E,{modelValue:t.crudTab,"onUpdate:modelValue":l[2]||(l[2]=a=>t.crudTab=a)},{default:c(()=>[i(_,{lazy:!0,label:e.$t("筛选"),name:"filter"},{default:c(()=>[i(h,{value:t.whereFilter,"onUpdate:value":l[0]||(l[0]=a=>t.whereFilter=a),"table-typ":"2","data-type-map":t.attrMap,options:t.eventAttrOptions},null,8,["value","data-type-map","options"])]),_:1},8,["label"]),i(_,{lazy:"true",label:e.$t("排序"),name:"sort"},{default:c(()=>[p("div",bt,[p("div",wt,[(u(!0),f(Y,null,G(t.sortList,(a,m)=>(u(),f("div",{key:m,class:"action-row row___xwl"},[p("div",kt,[i(U,{modelValue:t.sortList[m].col,"onUpdate:modelValue":y=>t.sortList[m].col=y,filterable:"",style:{width:"300px","margin-left":"30px"},placeholder:e.$t("请选择")},{default:c(()=>[(u(!0),f(Y,null,G(o.eventAttrOptionsProp,y=>(u(),w(v,{key:y.label,label:y.label},{default:c(()=>[(u(!0),f(Y,null,G(y.options,j=>(u(),w(x,{key:j.value,label:j.label,value:j.value},{default:c(()=>[p("span",Dt,O(j.label),1),p("span",xt,O(j.value),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),i(U,{modelValue:t.sortList[m].sortRule,"onUpdate:modelValue":y=>t.sortList[m].sortRule=y,style:{width:"100px","margin-left":"30px"},placeholder:e.$t("请选择排序规则"),filterable:""},{default:c(()=>[i(x,{label:e.$t("正序排"),value:"asc"},null,8,["label"]),i(x,{label:e.$t("倒序排"),value:"desc"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),i(M,{style:{"margin-left":"30px"},class:"actions_xwl_btn",onClick:y=>n.deleteSort(m)},{default:c(()=>[L("删除")]),_:2},1032,["onClick"])])]))),128))])]),p("div",St,[p("span",{style:{color:"#3d90ff"},class:"footadd___2D4YB",onClick:l[1]||(l[1]=(...a)=>n.pushSort&&n.pushSort(...a))},O(e.$t("增加排序")),1)])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),i(A,{class:"box-card"},{default:c(()=>[p("div",Ct,[i(r,null,{default:c(()=>[i(C,null,{default:c(()=>[i(M,{type:"warning",onClick:l[3]||(l[3]=a=>n.getdsl(1))},{default:c(()=>[L("查看查询语句 ")]),_:1}),i(M,{type:"success",onClick:l[4]||(l[4]=a=>n.search(1))},{default:c(()=>[L("查询 ")]),_:1}),i(M,{disabled:t.downloadLoading,loading:t.downloadLoading,type:"primary",onClick:l[5]||(l[5]=a=>n.download())},{default:c(()=>[L("下载 ")]),_:1},8,["disabled","loading"]),i(M,{disabled:n.selectedIds.length===0,type:"danger",onClick:n.batchDelete},{default:c(()=>[L("批量删除 ")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),se((u(),w(R,{height:"400",data:t.tableData,"use-virtual":"",ref:"multipleTable","row-height":30,"show-overflow-tooltip":"",onSelectionChange:n.handleSelectionChange},{default:c(()=>[i(g,{type:"selection",width:"55"}),i(g,{label:"ID",align:"center",fixed:"","min-width":"100",prop:"_id"}),(u(!0),f(Y,null,G(t.tableHeader,(a,m)=>(u(),f(Y,null,[a!="xwl_index"&&a!="_id"?(u(),w(g,{key:0,prop:a,sortable:!0,align:"center",label:a},null,8,["prop","label"])):$("",!0)],64))),256)),i(g,{align:"center",label:e.$t("操作"),fixed:"right",width:"200"},{default:c(a=>[i(D,null,{default:c(()=>[i(M,{type:"primary",onClick:m=>n.look(a.$index)},{default:c(()=>[L(" 编辑 ")]),_:2},1032,["onClick"]),i(M,{type:"danger",onClick:m=>n.deleteByID(a.row,a.$index)},{default:c(()=>[L(O(e.$t("删除")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange"])),[[k,t.tableLoading]]),i(T,{"current-page":t.input.page,"page-sizes":[10,20,30,50,100,150,200],"page-size":t.input.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.count,onSizeChange:n.handleSizeChange,onCurrentChange:n.search},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),i(H,{ref:"drawer",title:"详细数据","before-close":n.drawerHandleClose,modelValue:t.drawerShow,"onUpdate:modelValue":l[7]||(l[7]=a=>t.drawerShow=a),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:c(()=>[i(P,null,{default:c(()=>[L("操作")]),_:1}),i(M,{type:"primary",onClick:n.updateByID},{default:c(()=>[L("修改 ")]),_:1},8,["onClick"]),t.showJsonEditor1?(u(),w(I,{key:0,value:n.jsonDataString,"onUpdate:value":l[6]||(l[6]=a=>n.jsonDataString=a),height:"900",class:"res-body",styles:"width: 100%",title:"详细数据",onGetValue:n.getEditDoc},null,8,["value","onGetValue"])):$("",!0)]),_:1},8,["before-close","modelValue"]),i(H,{ref:"drawer",title:"查询DSL","before-close":n.drawerHandleClose,modelValue:t.queryDslShow,"onUpdate:modelValue":l[9]||(l[9]=a=>t.queryDslShow=a),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:c(()=>[t.showJsonEditor2?(u(),w(I,{key:0,value:n.queryDslString,"onUpdate:value":l[8]||(l[8]=a=>n.queryDslString=a),height:"900",class:"res-body",styles:"width: 100%",title:"DSL",read:!0},null,8,["value"])):$("",!0)]),_:1},8,["before-close","modelValue"])],64)):(u(),f("div",Vt,[i(q,{content:"请先点击左侧索引名称"})]))])])}const Yt=Q(ht,[["render",Mt],["__scopeId","data-v-d982da20"]]);const Tt={class:"navicat-container"},At={class:"content-wrapper"},It={class:"left-panel"},jt={class:"search-container"},Lt={class:"el-dropdown-link"},Nt={slot:"title"},Ot={class:"right-panel"},Ut={style:{height:"100%",width:"100%",display:"inline-block","vertical-align":"top"}},Et={__name:"index",setup(e){const l=S([]),o=S({}),s=S(!1),t=S(!0),n=S("settings"),h=S(!1),_=S([]),x=S(""),v=S(""),U=S({}),M=S([]),E=S(!1),C=S([]),r=Z(()=>x.value===""?_.value:De(_.value,x.value)),g=Z(()=>JSON.stringify(U.value,null,"	")),D=Z(()=>JSON.stringify(o.value,null,"	")),R=()=>{t.value=!1,ge(()=>{t.value=!0})},T=async k=>{v.value=k;const a={es_connect:N.sdk.GetSelectEsConnID(),index_name:v.value};s.value=!0;try{const m=await he(a);if(m.code!==0){s.value=!1,b.error(m.msg);return}const y=await xe(a);if(y.code!==0){s.value=!1,b.error(y.msg);return}o.value=m.data.list;const j=[{label:"筛选字段",options:[{value:"_id",label:"_id"}]}],K={2:[{attribute_name:"_id",show_name:"_id",data_type:3}]};let F={};switch(m.data.ver){case 6:for(let B of Object.keys(o.value[v.value].mappings))for(let J in o.value[v.value].mappings[B].properties)F[J]=o.value[v.value].mappings[B].properties[J];console.log("propertiesObj",F);break;case 7:case 8:F=o.value[v.value].mappings.properties;break}const ee=1,te=2,ae=3,X=5;for(const B in F)if(F[B].type){j[0].options.push({value:B,label:B});const J={attribute_name:B,show_name:B};switch(F[B].type){case"text":J.data_type=X;break;case"keyword":J.data_type=ae;break;case"byte":case"short":case"integer":case"long":J.data_type=ee;break;case"float":case"half_float":case"scaled_float":case"double":J.data_type=te;break}K[2].push(J)}C.value=K,M.value=j,U.value=y.data,s.value=!1,R()}catch(m){s.value=!1,b.error("An error occurred while fetching data.",m)}},A=k=>{const a=_.value.findIndex(m=>m.k.toString()===k.toString());a!==-1&&_.value.splice(a,1)},P=async(k,a)=>{try{await ne.confirm("删除该索引不可恢复，确认删除吗？",$t("警告"),{confirmButtonText:$t("确定"),cancelButtonText:$t("取消"),type:"warning"})}catch{return}const m=await Se({es_connect:N.sdk.GetSelectEsConnID(),index_name:a});m.code!==0?b({type:"error",message:m.msg}):(A(k),b({type:"success",message:m.msg}))};re(async()=>{console.log("navicat mounted"),I()}),Ee(async()=>{console.log("navicat activated")});const I=async()=>{const k={cat:"CatIndices",es_connect:N.sdk.GetSelectEsConnID()};_.value=[],h.value=!0,l.value=[];const a=await ke(k);if(a.code!=0){b({type:"error",message:a.msg}),h.value=!1;return}for(const m in a.data){const y=a.data[m],j={health:y.health,index:y.index,k:m,storeSize:y["store.size"],docsCount:y["docs.count"]};_.value.push(j),l.value.push({value:y.index,data:y.index})}h.value=!1},H=(k,a)=>{const m=k?l.value.filter(q(k)):l.value;a(m)},q=k=>a=>a.value.toLowerCase().includes(k.toLowerCase());return(k,a)=>{const m=d("el-autocomplete"),y=d("Grid"),j=d("el-icon"),K=d("el-dropdown-item"),F=d("el-dropdown-menu"),ee=d("el-dropdown"),te=d("el-menu-item"),ae=d("el-menu"),X=d("el-tab-pane"),B=d("el-tabs"),J=d("el-drawer"),de=be("loading");return u(),f("div",Tt,[p("div",At,[i(z(je),{class:"page-split",distribute:.2,lineThickness:3,isVertical:!0},{first:c(()=>[p("div",It,[p("div",jt,[i(m,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=V=>x.value=V),class:"search-input",clearable:"","fetch-suggestions":H,placeholder:k.$t("请输入索引名")},{default:c(({item:V})=>[p("span",null,O(V.value),1)]),_:1},8,["modelValue","placeholder"]),se((u(),w(ae,{class:"index-menu"},{default:c(()=>[(u(!0),f(Y,null,G(r.value,(V,le)=>(u(),w(te,{index:le.toString(),onClick:pe=>T(V.index),class:"menu-item"},{default:c(()=>[i(ee,null,{dropdown:c(()=>[i(F,null,{default:c(()=>[i(K,{onClick:pe=>P(r.value[le].k,r.value[le].index)},{default:c(()=>[L(O(k.$t("删除")),1)]),_:2},1032,["onClick"]),i(K,{onClick:a[1]||(a[1]=pe=>E.value=!0)},{default:c(()=>[L(O(k.$t("结构")),1)]),_:1})]),_:2},1024)]),default:c(()=>[p("span",Lt,[V.health=="red"?(u(),w(j,{key:0,style:{color:"red"}},{default:c(()=>[i(y)]),_:1})):$("",!0),V.health=="green"?(u(),w(j,{key:1,style:{color:"#13ce66"}},{default:c(()=>[i(y)]),_:1})):$("",!0),V.health=="yellow"?(u(),w(j,{key:2,style:{color:"#ffba00"}},{default:c(()=>[i(y)]),_:1})):$("",!0)])]),_:2},1024),p("span",Nt,O(V.index)+"【"+O(V.storeSize)+"】",1)]),_:2},1032,["index","onClick"]))),256))]),_:1})),[[de,h.value]])])])]),second:c(()=>[p("div",Ot,[t.value?(u(),w(Yt,{key:0,"attr-map-prop":C.value,"event-attr-options-prop":M.value,"index-name":v.value},null,8,["attr-map-prop","event-attr-options-prop","index-name"])):$("",!0)]),i(J,{ref:"drawer",title:k.$t("索引结构"),modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=V=>E.value=V),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:c(()=>[p("div",Ut,[se((u(),w(B,{modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=V=>n.value=V),type:"border-card"},{default:c(()=>[i(X,{lazy:!0,label:k.$t("索引设置"),name:"settings"},{default:c(()=>[t.value?(u(),w(ie,{key:0,value:g.value,"onUpdate:value":a[2]||(a[2]=V=>g.value=V),height:"720",styles:"width: 100%",read:!0,title:v.value},null,8,["value","title"])):$("",!0)]),_:1},8,["label"]),i(X,{lazy:!0,label:k.$t("映射结构"),name:"mappings"},{default:c(()=>[t.value?(u(),w(ie,{key:0,value:D.value,"onUpdate:value":a[3]||(a[3]=V=>D.value=V),height:"720",styles:"width: 100%",read:!0,title:v.value},null,8,["value","title"])):$("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])),[[de,s.value]])])]),_:1},8,["title","modelValue"])]),_:1})])])}}},qt=Q(Et,[["__scopeId","data-v-616aa3c9"]]);export{qt as default};
