var z=Object.defineProperty;var H=(e,l,s)=>l in e?z(e,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[l]=s;var m=(e,l,s)=>(H(e,typeof l!="symbol"?l+"":l,s),s);import{s as v,E as w,r,o as f,c as D,a as t,w as o,h as g,t as _,H as k,g as I,z as G,j as T,k as V,x as B,A as J,F as M,q as P}from"./index-fe3f31e4.js";import{S as q,C as K,a as Q,b as F}from"./es-backup-d35e6687.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";import{t as W,V as X,C as Y}from"./index-3421f69e.js";import{J as Z}from"./index-a9270ccf.js";const x={name:"Add",components:{},props:{open:{type:Boolean,default:!1},snapshotData:{type:Object,default:null}},data(){return{props_data:{open:this.open},isOpen:!1,form:{name:"",type:"fs",location:"",compress:"false",max_restore_bytes_per_sec:"40mb",max_snapshot_bytes_per_sec:"40mb",chunk_size:"",readonly:"false"}}},computed:{},created(){this.snapshotData!=null&&(this.form=Object.assign({},this.snapshotData))},methods:{closeDialog(){this.$emit("close",!1)},async confirm(){const e=this.form;e.es_connect=v.GetSelectEsConnID();const{code:l,data:s,msg:i}=await q(e);if(l==0){this.$emit("close",!0),w({type:"success",message:i});return}else{w({type:"error",message:i});return}}}};function ee(e,l,s,i,a,p){const c=r("el-input"),b=r("el-form-item"),h=r("el-option"),y=r("el-select"),$=r("el-form"),d=r("el-button"),E=r("el-card"),S=r("el-drawer");return f(),D("div",null,[t(S,{size:"80%",modelValue:a.props_data.open,"onUpdate:modelValue":l[8]||(l[8]=u=>a.props_data.open=u),title:e.$t("新增/修改快照存储库"),onClose:p.closeDialog},{default:o(()=>[t(E,{class:"box-card"},{footer:o(()=>[t(d,{type:"danger",onClick:p.closeDialog},{default:o(()=>[g(_(e.$t("取消")),1)]),_:1},8,["onClick"]),t(d,{type:"primary",onClick:p.confirm},{default:o(()=>[g(_(e.$t("确认")),1)]),_:1},8,["onClick"])]),default:o(()=>[t($,{"label-width":"300px","label-position":"left"},{default:o(()=>[t(b,{label:e.$t("存储库名")},{default:o(()=>[t(c,{modelValue:a.form.name,"onUpdate:modelValue":l[0]||(l[0]=u=>a.form.name=u),placeholder:e.$t("存储库名")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e.$t("类型（type）")},{default:o(()=>[t(y,{modelValue:a.form.type,"onUpdate:modelValue":l[1]||(l[1]=u=>a.form.type=u),filterable:""},{default:o(()=>[t(h,{label:"fs",value:"fs"}),t(h,{label:"url",value:"url"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(b,{label:e.$t("存储位置（location/url）")},{default:o(()=>[t(c,{modelValue:a.form.location,"onUpdate:modelValue":l[2]||(l[2]=u=>a.form.location=u),type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:e.$t("存储位置（location/url）")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e.$t("是否压缩 (compress)")},{default:o(()=>[t(y,{modelValue:a.form.compress,"onUpdate:modelValue":l[3]||(l[3]=u=>a.form.compress=u),clearable:"",filterable:""},{default:o(()=>[t(h,{label:e.$t("是"),value:"true"},null,8,["label"]),t(h,{label:e.$t("否"),value:"false"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(b,{label:e.$t("大文件分解块大小")},{default:o(()=>[t(c,{modelValue:a.form.chunk_size,"onUpdate:modelValue":l[4]||(l[4]=u=>a.form.chunk_size=u),placeholder:e.$t("1GB，10MB，5KB，500B。默认为null（无限制的块大小）")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e.$t("是否只读")},{default:o(()=>[t(y,{modelValue:a.form.readonly,"onUpdate:modelValue":l[5]||(l[5]=u=>a.form.readonly=u),filterable:""},{default:o(()=>[t(h,{label:e.$t("是"),value:"true"},null,8,["label"]),t(h,{label:e.$t("否"),value:"false"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(b,{label:e.$t("节点恢复速率")},{default:o(()=>[t(c,{modelValue:a.form.max_restore_bytes_per_sec,"onUpdate:modelValue":l[6]||(l[6]=u=>a.form.max_restore_bytes_per_sec=u),placeholder:e.$t("节点恢复速率")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e.$t("每个节点快照速率")},{default:o(()=>[t(c,{modelValue:a.form.max_snapshot_bytes_per_sec,"onUpdate:modelValue":l[7]||(l[7]=u=>a.form.max_snapshot_bytes_per_sec=u),placeholder:e.$t("每个节点快照速率")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue","title","onClose"])])}const le=N(x,[["render",ee]]);var te=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,ae=(e,l,s,i)=>{for(var a=i>1?void 0:i?oe(l,s):l,p=e.length-1,c;p>=0;p--)(c=e[p])&&(a=(i?c(l,s,a):c(a))||a);return i&&a&&te(l,s,a),a};let A=class extends X{constructor(){super(...arguments);m(this,"ctx",null);m(this,"snapshotData",null);m(this,"openAddDialog",!1);m(this,"loading",!1);m(this,"snapshotNameList",[]);m(this,"resData",{});m(this,"jsonData","{}");m(this,"name","");m(this,"drawerShow",!1);m(this,"tableData",[]);m(this,"index",0);m(this,"tableHeader",[])}mounted(){this.initSnapshotName(),this.search()}async CleanupeRepository(l){const s={};s.es_connect=v.GetSelectEsConnID(),s.name=l;const{data:i,code:a,msg:p}=await K(s);if(a!=0){w.error({type:"error",message:p});return}else{this.initSnapshotName(),this.search(),w.success({type:"success",message:p});return}}async SnapshotDeleteRepositoryAction(l){const s={};s.es_connect=v.GetSelectEsConnID(),s.name=l;const{data:i,code:a,msg:p}=await Q(s);if(a!=0){w.error({type:"error",message:p});return}else{this.initSnapshotName(),this.search(),w.success({type:"success",message:p});return}}updateSnapshotData(l){this.snapshotData=l,this.openAddDialog=!0}closeAddDialog(l){this.openAddDialog=!1,this.snapshotData=null,l&&(this.initSnapshotName(),this.search())}async initSnapshotName(){this.loading=!0;const l={};l.es_connect=v.GetSelectEsConnID();const{data:s,code:i,msg:a}=await F(l);i==0?(this.resData=s.res,k({title:"成功",dangerouslyUseHTMLString:!0,message:`
<strong> <b style="color: orange">您设置的path.repo为${s.pathRepo.join(",")}</b><br></strong>
          `,type:"success"})):i==199999?k({title:"Error",dangerouslyUseHTMLString:!0,message:`
<strong>
            <i style="color: orange">path.repo没有设置</i><br>
<i>在elasticsearch.yml 配置文件中配置仓库base目录</i><br>
<i>添加path.repo: /tmp/tmp (/tmp/tmp 为快照备份所在文件夹, <br><i style="color: orange">注意</i>首先要先创建这个文件夹)</i>

          `,type:"error"}):w.error({type:"error",message:a}),this.loading=!1}async search(){const l={};l.es_connect=v.GetSelectEsConnID(),l.snapshot_info_list=this.snapshotNameList,l.repository="test3";const{data:s,code:i,msg:a}=await F(l);if(i!=0){if(i!=199999){w.error({type:"error",message:a});return}}else i===199999?k({title:"Error",dangerouslyUseHTMLString:!0,message:`
        <strong>
          <i style="color: orange">path.repo没有设置</i><br>
          <i>在elasticsearch.yml 配置文件中配置仓库base目录</i><br>
          <i>添加path.repo: /tmp/tmp (/tmp/tmp 为快照备份所在文件夹, <br><i style="color: orange">注意</i>首先要先创建这个文件夹)</i>
        </strong>
      `,type:"error"}):this.tableData=s.list}openDetail(l,s,i){this.name=l.name,this.drawerShow=!0}look(l){this.name=l,this.jsonData=JSON.stringify(this.resData[l],null,"	"),this.drawerShow=!0}drawerHandleClose(l){l()}};A=ae([Y({name:"Task",components:{Add:le,JsonEditor:Z},setup(){return{ctx:I().appContext.config.globalProperties}}})],A);const se=W(A);const ne={class:"app-container"},re={class:"search-container"},ie={key:0},ue={key:1},pe={key:0},de={key:1};function me(e,l,s,i,a,p){const c=r("el-option"),b=r("el-select"),h=r("el-form-item"),y=r("el-button"),$=r("el-form"),d=r("el-table-column"),E=r("el-button-group"),S=r("el-table"),u=r("el-card"),U=r("json-editor"),j=r("el-drawer"),R=r("add"),O=G("loading");return f(),D("div",ne,[T("div",re,[t($,{inline:!0},{default:o(()=>[t(h,{label:"存储库"},{default:o(()=>[J((f(),V(b,{style:{width:"10rem"},modelValue:e.snapshotNameList,"onUpdate:modelValue":l[0]||(l[0]=n=>e.snapshotNameList=n),clearable:"",filterable:"",multiple:"",placeholder:e.$t("请选择存储库"),onChange:e.search},{default:o(()=>[(f(!0),D(M,null,P(e.resData,(n,C,L)=>(f(),V(c,{key:L,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"])),[[O,e.loading]])]),_:1}),t(h,null,{default:o(()=>[t(y,{type:"warning",onClick:l[1]||(l[1]=n=>e.openAddDialog=!0)},{default:o(()=>[g(_(e.$t("新建存储库")),1)]),_:1})]),_:1}),t(h,null,{default:o(()=>[t(y,{type:"success",onClick:e.search},{default:o(()=>[g(_(e.$t("刷新")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),t(u,{shadow:"never",class:"table-container"},{default:o(()=>[t(S,{data:e.tableData},{default:o(()=>[t(d,{label:e.$t("序号"),align:"center",fixed:"",width:"100"},{default:o(n=>[g(_(n.$index+1),1)]),_:1},8,["label"]),t(d,{align:"center",label:e.$t("存储库名"),prop:"name",width:"200"},null,8,["label"]),t(d,{align:"center",label:e.$t("存储库地址"),prop:"location",width:"300"},null,8,["label"]),t(d,{align:"center",label:e.$t("类型"),prop:"type",width:"200"},null,8,["label"]),t(d,{align:"center",label:e.$t("是否压缩"),prop:"compress",width:"100"},null,8,["label"]),t(d,{align:"center",label:e.$t("分解块大小"),prop:"chunk_size",width:"100"},null,8,["label"]),t(d,{align:"center",label:e.$t("是否只读(默认false)"),prop:"readonly",width:"100"},null,8,["label"]),t(d,{align:"center",label:e.$t("制作快照的速度"),width:"100"},{default:o(n=>[n.row.max_snapshot_bytes_per_sec!=""?(f(),D("div",ie,_(n.row.max_snapshot_bytes_per_sec)+"/s",1)):(f(),D("div",ue,"20mb/s"))]),_:1},8,["label"]),t(d,{align:"center",label:e.$t("快照恢复的速度"),width:"100"},{default:o(n=>[n.row.max_restore_bytes_per_sec!=""?(f(),D("div",pe,_(n.row.max_restore_bytes_per_sec)+"/s",1)):(f(),D("div",de,"20mb/s"))]),_:1},8,["label"]),t(d,{align:"center",label:e.$t("操作"),fixed:"right",width:"350"},{default:o(n=>[t(E,null,{default:o(()=>[t(y,{type:"success",onClick:C=>e.look(n.row.name)},{default:o(()=>[g(_(e.$t("查看")),1)]),_:2},1032,["onClick"]),t(y,{type:"warning",onClick:C=>e.updateSnapshotData(n.row)},{default:o(()=>[g(_(e.$t("修改")),1)]),_:2},1032,["onClick"]),t(y,{type:"danger",onClick:C=>e.SnapshotDeleteRepositoryAction(n.row.name)},{default:o(()=>[g(_(e.$t("删除")),1)]),_:2},1032,["onClick"]),t(y,{type:"warning",onClick:C=>e.CleanupeRepository(n.row.name)},{default:o(()=>[g(_(e.$t("清理")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),t(j,{ref:"drawer",title:e.$t("JSON数据"),"before-close":e.drawerHandleClose,modelValue:e.drawerShow,"onUpdate:modelValue":l[3]||(l[3]=n=>e.drawerShow=n),direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"80%"},{default:o(()=>[e.drawerShow?(f(),V(U,{key:0,value:e.jsonData,"onUpdate:value":l[2]||(l[2]=n=>e.jsonData=n),styles:"width: 100%",read:!0,title:e.$t("JSON数据")},null,8,["value","title"])):B("",!0)]),_:1},8,["title","before-close","modelValue"]),e.openAddDialog?(f(),V(R,{key:0,"snapshot-data":e.snapshotData,open:e.openAddDialog,onClose:e.closeAddDialog},null,8,["snapshot-data","open","onClose"])):B("",!0)])}const ge=N(se,[["render",me],["__scopeId","data-v-6f393f6f"]]);export{ge as default};
