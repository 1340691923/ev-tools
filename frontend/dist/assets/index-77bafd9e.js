var Z=Object.defineProperty;var x=(a,u,s)=>u in a?Z(a,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[u]=s;var g=(a,u,s)=>(x(a,typeof u!="symbol"?u+"":u,s),s);import{C as V,t as j,V as T,d as U}from"./index-6fe8c1bf.js";import{C as O,f as ee}from"./es-6fe4f219.js";import{k as I,E as W,r,A as M,o as i,c as B,m as k,a as e,w as t,j as w,t as h,B as R,b as m,F as q,v as J,y}from"./index-f7d1c908.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";var te=Object.defineProperty,ae=Object.getOwnPropertyDescriptor,H=(a,u,s,n)=>{for(var l=n>1?void 0:n?ae(u,s):u,f=a.length-1,c;f>=0;f--)(c=a[f])&&(l=(n?c(u,s,l):c(l))||l);return n&&l&&te(u,s,l),l};let E=class extends T{constructor(){super(...arguments);g(this,"catType","");g(this,"tableInfo",[]);g(this,"ctx",null);g(this,"total",0);g(this,"connectLoading",!1);g(this,"page",1);g(this,"limit",10);g(this,"pageshow",!0);g(this,"list",[]);g(this,"input","");g(this,"allList",[])}pageLimit(){this.list=this.allList.filter((s,n)=>n<this.page*this.limit&&n>=this.limit*(this.page-1))}search(){this.page=1,this.pageshow=!1,this.searchData(),this.$nextTick(()=>{this.pageshow=!0})}handleSizeChange(s){this.limit=s,this.pageLimit()}handleCurrentChange(s){this.page=s,this.pageLimit()}searchData(){this.connectLoading=!0;const s={cat:this.catType,es_connect:I.sdk.GetSelectEsConnID()};O(s).then(n=>{if(n.code==0){let l=n.data;if(l==null)return;for(const f in l){const c=l[f];for(const o in c){let b=Number(c[o]);isNaN(b)&&(b=c[o]),l[f][o.split(".").join("->")]=b}}l=ee(l,this.input.trim()),this.allList=l,this.total=l.length,this.pageLimit()}else W.error({type:"error",message:n.msg});this.connectLoading=!1}).catch(n=>{console.log(n),this.connectLoading=!1})}activated(){console.log("cat-index activated")}mounted(){console.log("cat-index mounted"),this.searchData()}};H([U],E.prototype,"catType",2);H([U],E.prototype,"tableInfo",2);E=H([V({name:"CatIndex",setup(){}})],E);const le=j(E),se={class:"app-container"},oe={class:"search-container"};function ne(a,u,s,n,l,f){const c=r("el-input"),o=r("el-form-item"),b=r("el-button"),p=r("el-form"),_=r("el-table-column"),A=r("el-table"),D=r("el-pagination"),N=r("el-card"),L=M("loading");return i(),B("div",null,[k("div",se,[k("div",oe,[e(p,{inline:!0},{default:t(()=>[e(o,{label:"关键词"},{default:t(()=>[e(c,{modelValue:a.input,"onUpdate:modelValue":u[0]||(u[0]=C=>a.input=C),style:{width:"7rem"},clearable:""},null,8,["modelValue"])]),_:1}),e(o,{label:""},{default:t(()=>[e(b,{type:"primary",onClick:a.search},{default:t(()=>[w(h(a.$t("搜索")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),e(N,{shadow:"never",class:"table-container"},{default:t(()=>[R((i(),m(A,{data:a.list},{default:t(()=>[e(_,{label:a.$t("序号"),align:"center",fixed:"",width:"100"},{default:t(C=>[w(h(C.$index+1),1)]),_:1},8,["label"]),(i(!0),B(q,null,J(a.tableInfo,(C,$)=>(i(),m(_,{"show-overflow-tooltip":"",key:$,align:"center",label:a.tableInfo[$].desc,width:C.width,prop:C.data.toString(),sortable:C.sort},{default:t(z=>[w(h(z.row[C.data.split("->").join(".")]),1)]),_:2},1032,["label","width","prop","sortable"]))),128))]),_:1},8,["data"])),[[L,a.connectLoading]]),a.pageshow?(i(),m(D,{key:0,class:"pagination-container","current-page":a.page,"page-sizes":[10,20,30,50,100,150,200,500,1e3],"page-size":a.limit,layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])):y("",!0)]),_:1})])])}const ue=G(le,[["render",ne]]);var de=Object.defineProperty,re=Object.getOwnPropertyDescriptor,ie=(a,u,s,n)=>{for(var l=n>1?void 0:n?re(u,s):u,f=a.length-1,c;f>=0;f--)(c=a[f])&&(l=(n?c(u,s,l):c(l))||l);return n&&l&&de(u,s,l),l};let P=class extends T{constructor(){super(...arguments);g(this,"list",[]);g(this,"connectLoading",!1);g(this,"value",90)}activated(){}mounted(){console.log("Node mounted"),this.searchData()}getOpt(s){const n=Number(s);return n<60?"#4ad47f":n>=60&&n<=80?"#ff9800":"red"}forceRefresh(){console.log("Force refresh triggered"),this.searchData()}async searchData(){console.log("searchData called"),this.connectLoading=!0;const s=await O({cat:"Node",es_connect:I.sdk.GetSelectEsConnID()}),n=await O({cat:"CatAllocation",es_connect:I.sdk.GetSelectEsConnID()});if(s.code!=0){W.error({type:"error",message:s.msg}),this.connectLoading=!1;return}for(const l in s.data){const f=s.data[l];for(const c in n.data){const o=n.data[c];if(o.node==f.name){s.data[l]["disk.indices"]=o["disk.indices"],s.data[l].shards=o.shards,s.data[l]["disk.avail"]=o["disk.avail"];break}}}this.list=s.data,this.connectLoading=!1}};P=ie([V({name:"Node"})],P);const ce=j(P);const pe={class:"app-container"},_e={class:"search-container"};function fe(a,u,s,n,l,f){const c=r("el-button"),o=r("el-form-item"),b=r("el-form"),p=r("el-tag"),_=r("el-col"),A=r("Star"),D=r("el-icon"),N=r("el-tooltip"),L=r("Tickets"),C=r("StarFilled"),$=r("CreditCard"),z=r("Postcard"),K=r("Wallet"),v=r("el-row"),F=r("el-progress"),Q=r("el-card"),X=M("loading");return R((i(),B("div",pe,[k("div",_e,[e(b,null,{default:t(()=>[e(o,null,{default:t(()=>[e(c,{type:"primary",onClick:a.searchData},{default:t(()=>[w("刷新 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),e(v,{gutter:40},{default:t(()=>[(i(!0),B(q,null,J(a.list,(d,Y)=>(i(),m(_,{key:Y,xs:40,sm:11,lg:11,class:"card-panel-col"},{default:t(()=>[e(Q,{shadow:"never",class:"table-container"},{default:t(()=>[e(b,{class:"responsive-form"},{default:t(()=>[e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"节点名:"},{default:t(()=>[e(p,null,{default:t(()=>[w("节点名:"+h(d.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:""},{default:t(()=>[k("div",null,[d.master==="*"?(i(),m(N,{key:0,content:"主节点",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"primary"},{default:t(()=>[e(D,null,{default:t(()=>[e(A)]),_:1})]),_:1})]),_:1})):d["node.role"].includes("m")&&d["node.role"].includes("v")?(i(),m(N,{key:1,content:"仅选举节点",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"primary"},{default:t(()=>[e(D,null,{default:t(()=>[e(L)]),_:1})]),_:1})]),_:1})):d["node.role"].includes("m")?(i(),m(N,{key:2,content:"主节点候选",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"primary"},{default:t(()=>[e(D,null,{default:t(()=>[e(C)]),_:1})]),_:1})]),_:1})):y("",!0),d["node.role"].includes("d")?(i(),m(N,{key:3,content:"数据节点",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"success"},{default:t(()=>[e(D,null,{default:t(()=>[e($)]),_:1})]),_:1})]),_:1})):y("",!0),d["node.role"].includes("i")?(i(),m(N,{key:4,content:"预处理节点",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"warning"},{default:t(()=>[e(D,null,{default:t(()=>[e(z)]),_:1})]),_:1})]),_:1})):y("",!0),d["node.role"]==="-"?(i(),m(N,{key:5,content:"仅协调节点",placement:"top",style:{cursor:"pointer"}},{default:t(()=>[e(p,{type:"warning"},{default:t(()=>[e(D,null,{default:t(()=>[e(K)]),_:1})]),_:1})]),_:1})):y("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"IP:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d.ip),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"主节点:"},{default:t(()=>[k("div",null,[d.master?(i(),m(p,{key:0},{default:t(()=>[w("yes")]),_:1})):d.masterEligible?(i(),m(p,{key:1},{default:t(()=>[w("eligible")]),_:1})):(i(),m(p,{key:2},{default:t(()=>[w("no")]),_:1}))])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"节点角色:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["node.role"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"负载:"},{default:t(()=>[e(p,null,{default:t(()=>[w("1m:"+h(d.load_1m)+" / 5m:"+h(d.load_5m)+" / 15m:"+h(d.load_15m),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"内存:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["ram.current"])+"/"+h(d["ram.max"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"堆内存:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["heap.current"])+"/ "+h(d["heap.max"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"磁盘:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["disk.used"])+"/ "+h(d["disk.total"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"磁盘可用:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["disk.avail"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"分片数:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d.shards),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"索引所占空间大小:"},{default:t(()=>[e(p,null,{default:t(()=>[w(h(d["disk.indices"]),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"CPU:"},{default:t(()=>[e(F,{"stroke-width":24,color:a.getOpt,"text-inside":!0,style:{"margin-right":"1px",width:"8rem"},percentage:Number(d.cpu)},null,8,["color","percentage"])]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"内存:"},{default:t(()=>[e(F,{"stroke-width":24,color:a.getOpt,"text-inside":!0,style:{"margin-right":"1px",width:"8rem"},percentage:Number(d["ram.percent"])},null,8,["color","percentage"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(o,{label:"堆内存:"},{default:t(()=>[e(F,{"stroke-width":24,color:a.getOpt,"text-inside":!0,style:{"margin-right":"1px",width:"8rem"},percentage:Number(d["heap.percent"])},null,8,["color","percentage"])]),_:2},1024)]),_:2},1024),e(_,{span:12},{default:t(()=>[e(o,{label:"磁盘:"},{default:t(()=>[e(F,{"stroke-width":24,color:a.getOpt,"text-inside":!0,style:{width:"8rem"},percentage:Number(d["disk.used_percent"])},null,8,["color","percentage"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])),[[X,a.connectLoading]])}const me=G(ce,[["render",fe],["__scopeId","data-v-61ab07cf"]]);var he=Object.defineProperty,ge=Object.getOwnPropertyDescriptor,we=(a,u,s,n)=>{for(var l=n>1?void 0:n?ge(u,s):u,f=a.length-1,c;f>=0;f--)(c=a[f])&&(l=(n?c(u,s,l):c(l))||l);return n&&l&&he(u,s,l),l};let S=class extends T{constructor(){super(...arguments);g(this,"activeName","Node");g(this,"catData",{CatIndices:[{data:"health",desc:"索引健康状态",sort:!0,width:100},{data:"status",desc:"索引的开启状态",sort:!0,width:100},{data:"index",desc:"索引名称",sort:!0,width:0},{data:"uuid",desc:"索引uuid",sort:!0,width:300},{data:"pri",desc:"索引主分片数",sort:!0,width:100},{data:"rep",desc:"索引副本分片数量",sort:!0,width:100},{data:"docs->count",desc:"索引中文档总数",sort:!0,width:100},{data:"docs->deleted",desc:"索引中删除状态的文档",sort:!0,width:100},{data:"store->size",desc:"主分片+副本分分片的大小",sort:!0,width:100},{data:"pri->store->size",desc:"主分片的大小",sort:!0,width:200}],CatAliases:[{data:"alias",desc:"别名",sort:!0,width:300},{data:"index",desc:"索引别名指向",sort:!0,width:0},{data:"filter",desc:"过滤器",sort:!0,width:220},{data:"index",desc:"索引路由",sort:!0,width:220},{data:"routing->search",desc:"搜索路由",sort:!0,width:220},{data:"is_write_index",desc:"写索引",sort:!0,width:220}],CatAllocation:[{data:"host",desc:"节点host",sort:!0,width:150},{data:"ip",desc:"节点ip",sort:!0,width:150},{data:"node",desc:"节点名称",sort:!0,width:0},{data:"shards",desc:"节点承载分片数量",sort:!0,width:150},{data:"disk->indices",desc:"索引占用空间大小",sort:!0,width:150},{data:"disk->used",desc:"节点所在机器已使用的磁盘空间大小",sort:!0,width:150},{data:"disk->avail",desc:"节点可用空间大小",sort:!0,width:170},{data:"disk->total",desc:"节点总空间大小",sort:!0,width:170},{data:"disk->percent",desc:"节点磁盘占用百分比",sort:!0,width:100}],CatCount:[{data:"epoch",desc:"自标准时间（1970-01-01 00:00:00）以来的秒数",sort:!0,width:0},{data:"timestamp",desc:"时分秒,utc时区",sort:!0,width:500},{data:"count",desc:"文档总数",sort:!0,width:500}],CatHealth:[{data:"cluster",desc:"集群名称",sort:!0,width:0},{data:"status",desc:"集群状态",sort:!0,width:100},{data:"node->total",desc:"节点总数",sort:!0,width:100},{data:"node->data",desc:"数据节点总数",sort:!0,width:100},{data:"shards",desc:"分片总数",sort:!0,width:100},{data:"pri",desc:"主分片总数",sort:!0,width:100},{data:"relo",desc:"复制节点总数",sort:!0,width:100},{data:"init",desc:"初始化节点总数",sort:!0,width:100},{data:"unassign",desc:"未分配分片总数",sort:!0,width:100},{data:"pending_tasks",desc:"待定任务总数",sort:!0,width:100},{data:"max_task_wait_time",desc:"等待最长任务的等待时间",sort:!0,width:100},{data:"active_shards_percent",desc:"活动分片百分比",sort:!0,width:100},{data:"epoch",desc:"自标准时间（1970-01-01 00:00:00）以来的秒数",sort:!0,width:0},{data:"timestamp",desc:"时分秒,utc时区",sort:!0,width:100}],CatShards:[{data:"index",desc:"索引名称",sort:!0,width:0},{data:"shard",desc:"分片序号",sort:!0,width:100},{data:"prirep",desc:"分片类型(p为主分片，r为复制分片)",sort:!0,width:220},{data:"state",desc:"分片状态",sort:!0,width:100},{data:"docs",desc:"该分片存放的文档数量",sort:!0,width:140},{data:"store",desc:"该分片占用的存储空间大小",sort:!0,width:200},{data:"ip",desc:"该分片所在的服务器ip",sort:!1,width:200},{data:"node",desc:"该分片所在的节点名称",sort:!0,width:200}]})}};S=we([V({name:"cat",components:{CatIndex:ue,Node:me}})],S);const be=j(S),ye={class:"app-container"};function Ce(a,u,s,n,l,f){const c=r("node"),o=r("el-tab-pane"),b=r("cat-index"),p=r("el-tabs");return i(),B("div",ye,[e(p,{modelValue:a.activeName,"onUpdate:modelValue":u[0]||(u[0]=_=>a.activeName=_)},{default:t(()=>[e(o,{lazy:!0,label:"节点",name:"Node"},{default:t(()=>[e(c)]),_:1}),e(o,{lazy:!0,label:"查看索引信息",name:"CatIndices"},{default:t(()=>[a.activeName=="CatIndices"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1}),e(o,{lazy:!0,label:"显示别名,过滤器,路由信息",name:"CatAliases"},{default:t(()=>[a.activeName=="CatAliases"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1}),e(o,{lazy:!0,label:"显示每个节点分片数量、占用空间",name:"CatAllocation"},{default:t(()=>[a.activeName=="CatAllocation"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1}),e(o,{lazy:!0,label:"显示索引文档的数量",name:"CatCount"},{default:t(()=>[a.activeName=="CatCount"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1}),e(o,{lazy:!0,label:"查看集群健康状况",name:"CatHealth"},{default:t(()=>[a.activeName=="CatHealth"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1}),e(o,{lazy:!0,label:"显示索引分片信息",name:"CatShards"},{default:t(()=>[a.activeName=="CatShards"?(i(),m(b,{key:0,"cat-type":a.activeName,"table-info":a.catData[a.activeName]},null,8,["cat-type","table-info"])):y("",!0)]),_:1})]),_:1},8,["modelValue"])])}const Fe=G(be,[["render",Ce]]);export{Fe as default};
